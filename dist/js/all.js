class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/"}static get RESTAURANT_URL(){return`${this.DATABASE_URL}restaurants/`}static get REVIEW_URL(){return`${this.DATABASE_URL}reviews/`}static get database(){if(!navigator.serviceWorker)return Promise.resolve();return(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB).open("rreviews",1)}static fetchRestaurants(e){DBHelper.getRestaurantDataFromIndexedDB().then(t=>{e(null,t)}),fetch(DBHelper.RESTAURANT_URL).then(e=>e.json()).then(t=>{DBHelper.storeRestaurantDataInIndexedDB(t),e(null,t)}).catch(t=>{e(t,null)})}static fetchRestaurantById(e,t){const n=`${this.REVIEW_URL}?restaurant_id=${e}`,a=DBHelper.database;DBHelper.upgadeIndexedDB(a),a&&(a.onsuccess=(r=>{const s=a.result;s.transaction(["rreviews"],"readwrite").objectStore("rreviews").index("id").openCursor().onsuccess=(a=>{const r=a.target.result;if(r)if(r.value.id==e){const e=r.value;fetch(n).then(e=>e.json()).then(n=>{e.reviews=n,s.transaction(["rreviews"],"readwrite").objectStore("rreviews").put(e),t(null,e)}).catch(n=>{t(null,e)})}else r.continue()})}))}static storeRestaurantDataInIndexedDB(e){const t=DBHelper.database;DBHelper.upgadeIndexedDB(t),t&&(t.onsuccess=(n=>{const a=t.result.transaction("rreviews","readwrite").objectStore("rreviews");e.forEach(e=>{a.put(e)})}))}static setRestaurantFavorite(e,t){const n=DBHelper.database;DBHelper.upgadeIndexedDB(n),n&&(n.onsuccess=(a=>{const r=n.result.transaction(["rreviews"],"readwrite").objectStore("rreviews").index("id"),s=`${this.RESTAURANT_URL}${e}/?is_favorite=${t}`;r.openCursor().onsuccess=(n=>{const a=n.target.result;if(a)if(a.value.id==e){a.value.is_favorite=t,a.update(a.value);const e=new Request(s,{method:"PUT"});fetch(e).catch(e=>{navigator.onLine||this.addRequestToQueue({url:s,options:{method:"PUT"}})})}else a.continue()})}))}static addRestaurantReview(e){const t=new Request(this.REVIEW_URL,{body:JSON.stringify(e),method:"POST"});fetch(t).then(e=>e.json()).then(t=>{this.fetchRestaurantById(e.restaurant_id,{})}).catch(t=>{navigator.onLine||this.addRequestToQueue({url:this.REVIEW_URL,options:{body:JSON.stringify(e),method:"POST"}}),this.fetchRestaurantById(e.restaurant_id,(t,n)=>{n.reviews.push(e);const a=DBHelper.database;DBHelper.upgadeIndexedDB(a),a&&(a.onsuccess=(e=>{a.result.transaction(["rreviews"],"readwrite").objectStore("rreviews").put(n)}))})})}static getRestaurantDataFromIndexedDB(){return new Promise((e,t)=>{const n=DBHelper.database;DBHelper.upgadeIndexedDB(n),n&&(n.onsuccess=(t=>{const a=[];n.result.transaction("rreviews","readonly").objectStore("rreviews").openCursor().onsuccess=(t=>{const n=t.target.result;n?(a.push(n.value),n.continue()):e(a)})}))})}static upgadeIndexedDB(e){e.onupgradeneeded=function(){const t=e.result,n=t.createObjectStore("rreviews",{keyPath:"id"});n.createIndex("name","name"),n.createIndex("id","id",{unique:!0}),t.createObjectStore("requestqueue",{autoIncrement:!0})}}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((a,r)=>{if(a)n(a,null);else{let a=r;"all"!=e&&(a=a.filter(t=>t.cuisine_type==e)),"all"!=t&&(a=a.filter(e=>e.neighborhood==t)),n(null,a)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph?e.photograph:e.id}`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}static addRequestToQueue(e){const t=DBHelper.database;DBHelper.upgadeIndexedDB(t),t&&(t.onsuccess=(n=>{t.result.transaction("requestqueue","readwrite").objectStore("requestqueue").put(e)}))}static sendQueuedRequests(){const e=DBHelper.database;DBHelper.upgadeIndexedDB(e),e&&(e.onsuccess=(t=>{e.result.transaction("requestqueue","readwrite").objectStore("requestqueue").openCursor().onsuccess=(e=>{const t=e.target.result;if(t){const e=new Request(t.value.url,t.value.options);fetch(e),t.delete(),t.continue()}})}))}}let map,restaurant;function fetchNeighborhoods(){DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(this.neighborhoods=t,fillNeighborhoodsHTML())})}function fillNeighborhoodsHTML(e=this.neighborhoods){const t=document.getElementById("neighborhoods-select");t&&e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.appendChild(n)})}function fetchCuisines(){DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(this.cuisines=t,fillCuisinesHTML())})}function fillCuisinesHTML(e=this.cuisines){const t=document.getElementById("cuisines-select");t&&e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.appendChild(n)})}function updateRestaurants(){const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,r=e[n].value,s=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}function resetRestaurants(e){this.restaurants=[],document.getElementById("restaurants-list").innerHTML="",this.markers&&this.markers.forEach(e=>e.setMap(null)),this.markers=[],this.restaurants=e}function fillRestaurantsHTML(e=this.restaurants){const t=document.getElementById("restaurants-list");e.forEach(e=>{t.appendChild(createRestaurantHTML(e))}),addMarkersToMap()}function createRestaurantHTML(e){void 0===e.is_favorite&&(e.is_favorite=!1);const t=document.createElement("li");t.className="restaurant-card";const n=document.createElement("picture");n.className="restaurant-picture";const a=document.createElement("source");a.className="source-small lazyload";let r=DBHelper.imageUrlForRestaurant(e).concat("-small.jpg"),s=r.replace("small","medium");a.setAttribute("data-srcset",r+" 1x, "+s+" 2x"),n.appendChild(a);const i=document.createElement("source");i.className="source-large lazyload";let o=r.replace("small","large");a.setAttribute("data-srcset",s+" 1x, "+o+" 2x"),i.media="(min-width: 750px)",n.appendChild(i);const l=document.createElement("img");l.className="restaurant-img lazyload",l.alt='Image of "'+e.name+'" restaurant.',l.setAttribute("data-src",r),n.appendChild(l);const c=document.createElement("div");c.className="restaurant-info-container",c.appendChild(n);const d=document.createElement("h2");d.innerHTML=e.name,c.appendChild(d);const u=document.createElement("a"),m=JSON.parse(e.is_favorite)?"Remove restaurant "+e.name+"from favorites.":"Add restaurant "+e.name+"to favorites.";u.className="tap-target top-right",u.setAttribute("aria-label",m),u.setAttribute("role","button"),u.setAttribute("tabindex","0"),u.setAttribute("data-restid",e.id),u.setAttribute("is-favorite",e.is_favorite),u.addEventListener("click",toggleFavorite,!1),c.appendChild(u);const p=document.createElement("i");p.className="material-icons favorite-icon",p.innerHTML=JSON.parse(e.is_favorite)?"favorite":"favorite_border",u.appendChild(p);const f=document.createElement("div");f.className="address-container";const h=document.createElement("p");h.setAttribute("aria-describedby","restaurant-neighborhood-label"),h.innerHTML=e.neighborhood,f.appendChild(h);const g=document.createElement("p");g.innerHTML=e.address,g.setAttribute("aria-describedby","restaurant-address-label"),f.appendChild(g),c.appendChild(f),t.appendChild(c);const v=document.createElement("a");return v.innerHTML="View Details",v.className="tap-target restaurant-card-details",v.setAttribute("aria-label","Restaurant: "+e.name+": view details."),v.setAttribute("role","button"),v.href=DBHelper.urlForRestaurant(e),t.appendChild(v),t}function addMarkersToMap(e=this.restaurants){e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,this.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),this.markers.push(t)})}function toggleFavorite(e){e||(e=window.event);const t=e.srcElement||e.target,n=this.dataset.restid;let a=!JSON.parse(this.getAttribute("is-favorite"));n&&(this.setAttribute("is-favorite",a),DBHelper.setRestaurantFavorite(n,a),t==this?this.childNodes.length>0&&(this.childNodes[0].innerHTML=a?"favorite":"favorite_border"):t.innerHTML=a?"favorite":"favorite_border")}function fetchRestaurantFromURL(e){if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):e("No restaurant id in URL",null)}function fillRestaurantHTML(e=self.restaurant){document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img";let n=DBHelper.imageUrlForRestaurant(e).concat("-small.jpg");t.setAttribute("data-src",n),t.alt='Image of "'+e.name+'" restaurant.';const a=document.getElementById("source-small");let r=n.replace("small","medium");a.srcset=n+" 1x, "+r+" 2x";const s=document.getElementById("source-large");let i=n.replace("small","large");s.srcset=r+" 1x, "+i+" 2x",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}function fillRestaurantHoursHTML(e=self.restaurant.operating_hours){const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,r.className="table-day",a.appendChild(r);const s=document.createElement("td");s.innerHTML=e[n],s.className="table-time",a.appendChild(s),t.appendChild(a)}}function submitReview(e){e||(e=window.event);const t=(e.srcElement||e.target).getAttribute("restaurant-id"),n=document.getElementById("review-name").value,a=document.getElementById("review-text").value,r=document.getElementById("review-rating").value;if(n&&a){const e={restaurant_id:t,name:n,rating:r,comments:a,createdAt:(new Date).getTime()};document.getElementById("reviews-list").appendChild(createReviewHTML(e));DBHelper.addRestaurantReview(e)}}function fillReviewsHTML(e=self.restaurant.reviews,t=self.restaurant.id){const n=document.getElementById("reviews-container");if(!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void n.appendChild(e)}const a=document.getElementById("add-comment");a.setAttribute("restaurant-id",t),a.addEventListener("click",submitReview,!1);const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),n.appendChild(r)}function createReviewHTML(e){const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const a=document.createElement("p");a.innerHTML=new Date(e.createdAt).toLocaleDateString(),t.appendChild(a);const r=document.createElement("p");r.innerHTML=`Rating: ${e.rating}`,t.appendChild(r);const s=document.createElement("p");return s.className="review-comments",s.innerHTML=e.comments,t.appendChild(s),t}function fillBreadcrumb(e=self.restaurant){const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}!function(e,t){var n=function(e,t){"use strict";if(t.getElementsByClassName){var n,a,r=t.documentElement,s=e.Date,i=e.HTMLPictureElement,o="addEventListener",l="getAttribute",c=e[o],d=e.setTimeout,u=e.requestAnimationFrame||d,m=e.requestIdleCallback,p=/^picture$/i,f=["load","error","lazyincluded","_lazyloaded"],h={},g=Array.prototype.forEach,v=function(e,t){return h[t]||(h[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),h[t].test(e[l]("class")||"")&&h[t]},b=function(e,t){v(e,t)||e.setAttribute("class",(e[l]("class")||"").trim()+" "+t)},y=function(e,t){var n;(n=v(e,t))&&e.setAttribute("class",(e[l]("class")||"").replace(n," "))},E=function(e,t,n){var a=n?o:"removeEventListener";n&&E(e,t),f.forEach(function(n){e[a](n,t)})},w=function(e,a,r,s,i){var o=t.createEvent("CustomEvent");return r||(r={}),r.instance=n,o.initCustomEvent(a,!s,!i,r),e.dispatchEvent(o),o},B=function(t,n){var r;!i&&(r=e.picturefill||a.pf)?r({reevaluate:!0,elements:[t]}):n&&n.src&&(t.src=n.src)},R=function(e,t){return(getComputedStyle(e,null)||{})[t]},H=function(e,t,n){for(n=n||e.offsetWidth;n<a.minSize&&t&&!e._lazysizesWidth;)n=t.offsetWidth,t=t.parentNode;return n},C=function(){var e,n,a=[],r=[],s=a,i=function(){var t=s;for(s=a.length?r:a,e=!0,n=!1;t.length;)t.shift()();e=!1},o=function(a,r){e&&!r?a.apply(this,arguments):(s.push(a),n||(n=!0,(t.hidden?d:u)(i)))};return o._lsFlush=i,o}(),D=function(e,t){return t?function(){C(e)}:function(){var t=this,n=arguments;C(function(){e.apply(t,n)})}},A=function(e){var t,n=0,r=a.throttleDelay,i=a.ricTimeout,o=function(){t=!1,n=s.now(),e()},l=m&&i>49?function(){m(o,{timeout:i}),i!==a.ricTimeout&&(i=a.ricTimeout)}:D(function(){d(o)},!0);return function(e){var a;(e=!0===e)&&(i=33),t||(t=!0,0>(a=r-(s.now()-n))&&(a=0),e||9>a?l():d(l,a))}},L=function(e){var t,n,a=function(){t=null,e()},r=function(){var e=s.now()-n;99>e?d(r,99-e):(m||a)(a)};return function(){n=s.now(),t||(t=d(r,99))}};!function(){var t,n={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(t in a=e.lazySizesConfig||e.lazysizesConfig||{},n)t in a||(a[t]=n[t]);e.lazySizesConfig=a,d(function(){a.init&&I()})}();var M=function(){var i,u,m,f,h,H,M,I,z,N,x,_,S,k,F=/^img$/i,q=/^iframe$/i,U="onscroll"in e&&!/glebot/.test(navigator.userAgent),j=0,O=0,W=-1,P=function(e){O--,e&&e.target&&E(e.target,P),(!e||0>O||!e.target)&&(O=0)},$=function(e,n){var a,s=e,i="hidden"==R(t.body,"visibility")||"hidden"!=R(e,"visibility");for(I-=n,x+=n,z-=n,N+=n;i&&(s=s.offsetParent)&&s!=t.body&&s!=r;)(i=(R(s,"opacity")||1)>0)&&"visible"!=R(s,"overflow")&&(a=s.getBoundingClientRect(),i=N>a.left&&z<a.right&&x>a.top-1&&I<a.bottom+1);return i},V=function(){var e,s,o,c,d,m,p,h,g,v=n.elements;if((f=a.loadMode)&&8>O&&(e=v.length)){s=0,W++,null==S&&("expand"in a||(a.expand=r.clientHeight>500&&r.clientWidth>500?500:370),_=a.expand,S=_*a.expFactor),S>j&&1>O&&W>2&&f>2&&!t.hidden?(j=S,W=0):j=f>1&&W>1&&6>O?_:0;for(;e>s;s++)if(v[s]&&!v[s]._lazyRace)if(U)if((h=v[s][l]("data-expand"))&&(m=1*h)||(m=j),g!==m&&(H=innerWidth+m*k,M=innerHeight+m,p=-1*m,g=m),o=v[s].getBoundingClientRect(),(x=o.bottom)>=p&&(I=o.top)<=M&&(N=o.right)>=p*k&&(z=o.left)<=H&&(x||N||z||I)&&(a.loadHidden||"hidden"!=R(v[s],"visibility"))&&(u&&3>O&&!h&&(3>f||4>W)||$(v[s],m))){if(X(v[s]),d=!0,O>9)break}else!d&&u&&!c&&4>O&&4>W&&f>2&&(i[0]||a.preloadAfterLoad)&&(i[0]||!h&&(x||N||z||I||"auto"!=v[s][l](a.sizesAttr)))&&(c=i[0]||v[s]);else X(v[s]);c&&!d&&X(c)}},J=A(V),Q=function(e){b(e.target,a.loadedClass),y(e.target,a.loadingClass),E(e.target,Y),w(e.target,"lazyloaded")},K=D(Q),Y=function(e){K({target:e.target})},Z=function(e){var t,n=e[l](a.srcsetAttr);(t=a.customMedia[e[l]("data-media")||e[l]("media")])&&e.setAttribute("media",t),n&&e.setAttribute("srcset",n)},G=D(function(e,t,n,r,s){var i,o,c,u,f,h;(f=w(e,"lazybeforeunveil",t)).defaultPrevented||(r&&(n?b(e,a.autosizesClass):e.setAttribute("sizes",r)),o=e[l](a.srcsetAttr),i=e[l](a.srcAttr),s&&(c=e.parentNode,u=c&&p.test(c.nodeName||"")),h=t.firesLoad||"src"in e&&(o||i||u),f={target:e},h&&(E(e,P,!0),clearTimeout(m),m=d(P,2500),b(e,a.loadingClass),E(e,Y,!0)),u&&g.call(c.getElementsByTagName("source"),Z),o?e.setAttribute("srcset",o):i&&!u&&(q.test(e.nodeName)?function(e,t){try{e.contentWindow.location.replace(t)}catch(n){e.src=t}}(e,i):e.src=i),s&&(o||u)&&B(e,{src:i})),e._lazyRace&&delete e._lazyRace,y(e,a.lazyClass),C(function(){(!h||e.complete&&e.naturalWidth>1)&&(h?P(f):O--,Q(f))},!0)}),X=function(e){var t,n=F.test(e.nodeName),r=n&&(e[l](a.sizesAttr)||e[l]("sizes")),s="auto"==r;(!s&&u||!n||!e[l]("src")&&!e.srcset||e.complete||v(e,a.errorClass)||!v(e,a.lazyClass))&&(t=w(e,"lazyunveilread").detail,s&&T.updateElem(e,!0,e.offsetWidth),e._lazyRace=!0,O++,G(e,t,s,r,n))},ee=function(){if(!u){if(s.now()-h<999)return void d(ee,999);var e=L(function(){a.loadMode=3,J()});u=!0,a.loadMode=3,J(),c("scroll",function(){3==a.loadMode&&(a.loadMode=2),e()},!0)}};return{_:function(){h=s.now(),n.elements=t.getElementsByClassName(a.lazyClass),i=t.getElementsByClassName(a.lazyClass+" "+a.preloadClass),k=a.hFac,c("scroll",J,!0),c("resize",J,!0),e.MutationObserver?new MutationObserver(J).observe(r,{childList:!0,subtree:!0,attributes:!0}):(r[o]("DOMNodeInserted",J,!0),r[o]("DOMAttrModified",J,!0),setInterval(J,999)),c("hashchange",J,!0),["focus","mouseover","click","load","transitionend","animationend","webkitAnimationEnd"].forEach(function(e){t[o](e,J,!0)}),/d$|^c/.test(t.readyState)?ee():(c("load",ee),t[o]("DOMContentLoaded",J),d(ee,2e4)),n.elements.length?(V(),C._lsFlush()):J()},checkElems:J,unveil:X}}(),T=function(){var e,n=D(function(e,t,n,a){var r,s,i;if(e._lazysizesWidth=a,a+="px",e.setAttribute("sizes",a),p.test(t.nodeName||""))for(r=t.getElementsByTagName("source"),s=0,i=r.length;i>s;s++)r[s].setAttribute("sizes",a);n.detail.dataAttr||B(e,n.detail)}),r=function(e,t,a){var r,s=e.parentNode;s&&(a=H(e,s,a),(r=w(e,"lazybeforesizes",{width:a,dataAttr:!!t})).defaultPrevented||(a=r.detail.width)&&a!==e._lazysizesWidth&&n(e,s,r,a))},s=L(function(){var t,n=e.length;if(n)for(t=0;n>t;t++)r(e[t])});return{_:function(){e=t.getElementsByClassName(a.autosizesClass),c("resize",s)},checkElems:s,updateElem:r}}(),I=function(){I.i||(I.i=!0,T._(),M._())};return n={cfg:a,autoSizer:T,loader:M,init:I,uP:B,aC:b,rC:y,hC:v,fire:w,gW:H,rAF:C}}}(e,e.document);e.lazySizes=n,"object"==typeof module&&module.exports&&(module.exports=n)}(window),document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines()}),window.initMap=(()=>{this.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),window.initMapDetails=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),"serviceWorker"in navigator&&(window.addEventListener("load",()=>{if(document.getElementById("styles").removeAttribute("disabled"),document.querySelectorAll("#map").length>0){const e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZOJtKVTyEcz-RVVr4aePsebEPAP9JYaw&libraries=places&callback=initMap",document.getElementsByTagName("head")[0].appendChild(e)}navigator.serviceWorker.register("sw.js").then(()=>{console.log("Service Worker Registerd")}).catch(e=>{console.error(e)})}),window.addEventListener("online",DBHelper.sendQueuedRequests,!1));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJhbGwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyplc2xpbnQgbm8tdW51c2VkLXZhcnM6IDAqL1xyXG4vKmVzbGludCBuby11bmRlZjogMCovXHJcbi8qZXNsaW50IG5vLWNvbnNvbGU6IDAqL1xyXG4vKmVzbGludCBsaW5lYnJlYWstc3R5bGU6IFtcImVycm9yXCIsIFwid2luZG93c1wiXSovXHJcbi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHQvKipcclxuXHQgKiBEYXRhYmFzZSBVUkwuXHJcblx0ICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG5cdFx0Y29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuXHRcdHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L2A7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0IFJFU1RBVVJBTlRfVVJMKCkge1xyXG5cdFx0Y29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuXHRcdHJldHVybiBgJHt0aGlzLkRBVEFCQVNFX1VSTH1yZXN0YXVyYW50cy9gO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldCBSRVZJRVdfVVJMKCkge1xyXG5cdFx0Y29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuXHRcdHJldHVybiBgJHt0aGlzLkRBVEFCQVNFX1VSTH1yZXZpZXdzL2A7XHJcblx0fVxyXG5cclxuXHJcblx0c3RhdGljIGdldCBkYXRhYmFzZSgpIHtcclxuXHRcdC8vIElmIHRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBzZXJ2aWNlIHdvcmtlcixcclxuXHRcdC8vIHdlIGRvbid0IGNhcmUgYWJvdXQgaGF2aW5nIGEgZGF0YWJhc2VcclxuXHRcdGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG5cdFx0fVxyXG5cdFx0Y29uc3QgaW5kZXhlZERCID0gd2luZG93LmluZGV4ZWREQiB8fCB3aW5kb3cubW96SW5kZXhlZERCIHx8IHdpbmRvdy53ZWJraXRJbmRleGVkREIgfHwgd2luZG93Lm1zSW5kZXhlZERCIHx8IHdpbmRvdy5zaGltSW5kZXhlZERCO1xyXG5cdFx0cmV0dXJuIGluZGV4ZWREQi5vcGVuKCdycmV2aWV3cycsIDEpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcblx0XHREQkhlbHBlci5nZXRSZXN0YXVyYW50RGF0YUZyb21JbmRleGVkREIoKS50aGVuKGRhdGEgPT4ge1xyXG5cdFx0XHRjYWxsYmFjayhudWxsLCBkYXRhKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdGZldGNoKERCSGVscGVyLlJFU1RBVVJBTlRfVVJMKVxyXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiB7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuXHRcdFx0fSlcclxuXHRcdFx0LnRoZW4oZGF0YSA9PiB7XHJcblx0XHRcdFx0Ly9Hb3QgdGhlIGRhdGEsIG5vdyB3cml0dGluZyBpdCBpbiB0aGUgZGF0YWJhc2UuXHJcblx0XHRcdFx0REJIZWxwZXIuc3RvcmVSZXN0YXVyYW50RGF0YUluSW5kZXhlZERCKGRhdGEpO1xyXG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xyXG5cdFx0XHR9KVxyXG5cdFx0XHQuY2F0Y2goZXJyb3IgPT4ge1xyXG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuXHRcdFx0fSk7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuXHRcdGNvbnN0IHJldmlld1VSTCA9IGAke3RoaXMuUkVWSUVXX1VSTH0/cmVzdGF1cmFudF9pZD0ke2lkfWA7XHJcblx0XHRjb25zdCBEQk9wZW5SZXF1ZXN0ID0gREJIZWxwZXIuZGF0YWJhc2U7XHJcblx0XHREQkhlbHBlci51cGdhZGVJbmRleGVkREIoREJPcGVuUmVxdWVzdCk7XHJcblx0XHRpZiAoREJPcGVuUmVxdWVzdCkge1xyXG5cdFx0XHREQk9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IGRiID0gREJPcGVuUmVxdWVzdC5yZXN1bHQ7XHJcblx0XHRcdFx0Y29uc3Qgc3RvcmUgPSBkYi50cmFuc2FjdGlvbihbJ3JyZXZpZXdzJ10sICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZSgncnJldmlld3MnKTtcclxuXHRcdFx0XHRjb25zdCBpbmRleCA9IHN0b3JlLmluZGV4KCdpZCcpO1xyXG5cclxuXHRcdFx0XHRpbmRleC5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7XHJcblx0XHRcdFx0XHRjb25zdCBjdXJzb3IgPSBldmVudC50YXJnZXQucmVzdWx0O1xyXG5cdFx0XHRcdFx0aWYgKGN1cnNvcikge1xyXG5cdFx0XHRcdFx0XHRpZiAoY3Vyc29yLnZhbHVlLmlkID09IGlkKSB7XHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgcmVzdGF1cmFudCA9IGN1cnNvci52YWx1ZTtcclxuXHRcdFx0XHRcdFx0XHRmZXRjaChyZXZpZXdVUkwpXHJcblx0XHRcdFx0XHRcdFx0XHQudGhlbihyZXNwb25zZSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcblx0XHRcdFx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0XHRcdFx0LnRoZW4oZGF0YSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdC8vR290IHRoZSBkYXRhLCBub3cgd3JpdHRpbmcgaXQgaW4gdGhlIGRhdGFiYXNlLlxyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXN0YXVyYW50LnJldmlld3MgPSBkYXRhO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRkYi50cmFuc2FjdGlvbihbJ3JyZXZpZXdzJ10sICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZSgncnJldmlld3MnKS5wdXQocmVzdGF1cmFudCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSlcclxuXHRcdFx0XHRcdFx0XHRcdC5jYXRjaChlcnJvciA9PiB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0Y3Vyc29yLmNvbnRpbnVlKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHN0YXRpYyBzdG9yZVJlc3RhdXJhbnREYXRhSW5JbmRleGVkREIoZGF0YSkge1xyXG5cdFx0Ly9Hb3QgdGhlIGRhdGEsIG5vdyB3cml0dGluZyBpdCBpbiB0aGUgZGF0YWJhc2UuXHJcblx0XHRjb25zdCBEQk9wZW5SZXF1ZXN0ID0gREJIZWxwZXIuZGF0YWJhc2U7XHJcblx0XHREQkhlbHBlci51cGdhZGVJbmRleGVkREIoREJPcGVuUmVxdWVzdCk7XHJcblx0XHRpZiAoREJPcGVuUmVxdWVzdCkge1xyXG5cdFx0XHREQk9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IGV2ZW50ID0+IHtcclxuXHRcdFx0XHRjb25zdCBkYiA9IERCT3BlblJlcXVlc3QucmVzdWx0O1xyXG5cdFx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3JyZXZpZXdzJywgJ3JlYWR3cml0ZScpO1xyXG5cdFx0XHRcdGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3JyZXZpZXdzJyk7XHJcblx0XHRcdFx0ZGF0YS5mb3JFYWNoKChyZXN0YXVyYW50KSA9PiB7XHJcblx0XHRcdFx0XHRzdG9yZS5wdXQocmVzdGF1cmFudCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH07XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgc2V0UmVzdGF1cmFudEZhdm9yaXRlKGlkLCBzdGF0ZSkge1xyXG5cdFx0Ly9Hb3QgdGhlIGRhdGEsIG5vdyB3cml0dGluZyBpdCBpbiB0aGUgZGF0YWJhc2UuXHJcblx0XHQvL1dlIGNvdWxkIGhhdmUganVzdCB1c2VkIHJlc3BvbnNlIGZyb20gUFVUXHJcblx0XHQvL21ldGhvZCwgYnV0IGluIGNhc2Ugd2UncmUgb2ZmbGluZSBsZXQncyB1cGRhdGUgdGhlIGRiIGZpcnN0XHJcblx0XHRjb25zdCBEQk9wZW5SZXF1ZXN0ID0gREJIZWxwZXIuZGF0YWJhc2U7XHJcblx0XHREQkhlbHBlci51cGdhZGVJbmRleGVkREIoREJPcGVuUmVxdWVzdCk7XHJcblx0XHRpZiAoREJPcGVuUmVxdWVzdCkge1xyXG5cdFx0XHREQk9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IGRiID0gREJPcGVuUmVxdWVzdC5yZXN1bHQ7XHJcblx0XHRcdFx0Y29uc3QgaW5kZXggPSBkYi50cmFuc2FjdGlvbihbJ3JyZXZpZXdzJ10sICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZSgncnJldmlld3MnKS5pbmRleCgnaWQnKTtcclxuXHRcdFx0XHRjb25zdCB1cmwgPSBgJHt0aGlzLlJFU1RBVVJBTlRfVVJMfSR7aWR9Lz9pc19mYXZvcml0ZT0ke3N0YXRlfWA7XHJcblx0XHRcdFx0aW5kZXgub3BlbkN1cnNvcigpLm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xyXG5cdFx0XHRcdFx0Y29uc3QgY3Vyc29yID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcclxuXHRcdFx0XHRcdGlmIChjdXJzb3IpIHtcclxuXHRcdFx0XHRcdFx0aWYgKGN1cnNvci52YWx1ZS5pZCA9PSBpZCkge1xyXG5cdFx0XHRcdFx0XHRcdGN1cnNvci52YWx1ZS5pc19mYXZvcml0ZSA9IHN0YXRlO1xyXG5cdFx0XHRcdFx0XHRcdGN1cnNvci51cGRhdGUoY3Vyc29yLnZhbHVlKTtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCByZXEgPSBuZXcgUmVxdWVzdCh1cmwsIHtcclxuXHRcdFx0XHRcdFx0XHRcdG1ldGhvZDogJ1BVVCdcclxuXHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0XHRmZXRjaChyZXEpLmNhdGNoKGUgPT4ge1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYoIW5hdmlnYXRvci5vbkxpbmUpe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR0aGlzLmFkZFJlcXVlc3RUb1F1ZXVlKHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQndXJsJzogdXJsLCBcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQnb3B0aW9ucyc6IHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG1ldGhvZDogJ1BVVCdcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGN1cnNvci5jb250aW51ZSgpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fTtcclxuXHJcblx0XHRcdH07XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgYWRkUmVzdGF1cmFudFJldmlldyhkYXRhKSB7XHJcblx0XHRjb25zdCByZXEgPSBuZXcgUmVxdWVzdCh0aGlzLlJFVklFV19VUkwsIHtcclxuXHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXHJcblx0XHRcdG1ldGhvZDogJ1BPU1QnXHJcblx0XHR9KTtcclxuXHRcdGZldGNoKHJlcSkudGhlbihyZXNwb25zZSA9PiB7XHJcblx0XHRcdHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcblx0XHR9KS50aGVuKHJldmlldyA9PiB7XHJcblx0XHRcdC8vZG8gYSByZWZyZXNoXHJcblx0XHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50QnlJZChkYXRhLnJlc3RhdXJhbnRfaWQsIHt9KTtcclxuXHRcdH0pLmNhdGNoKGUgPT4ge1xyXG5cdFx0XHRpZighbmF2aWdhdG9yLm9uTGluZSl7XHJcblx0XHRcdFx0dGhpcy5hZGRSZXF1ZXN0VG9RdWV1ZSh7XHJcblx0XHRcdFx0XHR1cmw6IHRoaXMuUkVWSUVXX1VSTCwgXHJcblx0XHRcdFx0XHRvcHRpb25zOiB7XHJcblx0XHRcdFx0XHRcdGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG5cdFx0XHRcdFx0XHRtZXRob2Q6ICdQT1NUJ1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50QnlJZChkYXRhLnJlc3RhdXJhbnRfaWQsIChlcnIsIHJzdCkgPT4ge1xyXG5cdFx0XHRcdHJzdC5yZXZpZXdzLnB1c2goZGF0YSk7XHJcblx0XHRcdFx0Y29uc3QgREJPcGVuUmVxdWVzdCA9IERCSGVscGVyLmRhdGFiYXNlO1xyXG5cdFx0XHRcdERCSGVscGVyLnVwZ2FkZUluZGV4ZWREQihEQk9wZW5SZXF1ZXN0KTtcclxuXHRcdFx0XHRpZiAoREJPcGVuUmVxdWVzdCkge1xyXG5cdFx0XHRcdFx0REJPcGVuUmVxdWVzdC5vbnN1Y2Nlc3MgPSAoZXZlbnQpID0+IHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgZGIgPSBEQk9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuXHRcdFx0XHRcdFx0ZGIudHJhbnNhY3Rpb24oWydycmV2aWV3cyddLCAncmVhZHdyaXRlJykub2JqZWN0U3RvcmUoJ3JyZXZpZXdzJykucHV0KHJzdCk7XHJcblx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRSZXN0YXVyYW50RGF0YUZyb21JbmRleGVkREIoKSB7XHJcblx0XHQvL0l0IHNlZW1zIGxpa2Ugd2UndmUgZ290IGFuIGVycm9yIHdoaWxlIHRyeWluZyB0byByZWFkIGZyb20gdGhlIHNlcnZlclxyXG5cdFx0Ly9TbyB0cnlpbmcgdG8gZ2V0IGRhdGEgZnJvbSB0aGUgaW5kZXhlZERCIG5vd1xyXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHRcdFx0Y29uc3QgREJPcGVuUmVxdWVzdCA9IERCSGVscGVyLmRhdGFiYXNlO1xyXG5cdFx0XHREQkhlbHBlci51cGdhZGVJbmRleGVkREIoREJPcGVuUmVxdWVzdCk7XHJcblx0XHRcdGlmIChEQk9wZW5SZXF1ZXN0KSB7XHJcblx0XHRcdFx0REJPcGVuUmVxdWVzdC5vbnN1Y2Nlc3MgPSBldmVudCA9PiB7XHJcblx0XHRcdFx0XHRjb25zdCBkYiA9IERCT3BlblJlcXVlc3QucmVzdWx0O1xyXG5cdFx0XHRcdFx0Y29uc3Qgc3RvcmUgPSBkYi50cmFuc2FjdGlvbigncnJldmlld3MnLCAncmVhZG9ubHknKS5vYmplY3RTdG9yZSgncnJldmlld3MnKTtcclxuXHRcdFx0XHRcdGNvbnN0IGRhdGEgPSBbXTtcclxuXHRcdFx0XHRcdHN0b3JlLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSBldmVudCA9PiB7XHJcblx0XHRcdFx0XHRcdGNvbnN0IGN1cnNvciA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XHJcblx0XHRcdFx0XHRcdGlmIChjdXJzb3IpIHtcclxuXHRcdFx0XHRcdFx0XHRkYXRhLnB1c2goY3Vyc29yLnZhbHVlKTtcclxuXHRcdFx0XHRcdFx0XHRjdXJzb3IuY29udGludWUoKTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdH07XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIHVwZ2FkZUluZGV4ZWREQihEQk9wZW5SZXF1ZXN0KSB7XHJcblx0XHREQk9wZW5SZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0Y29uc3QgZGIgPSBEQk9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuXHRcdFx0Y29uc3Qgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgncnJldmlld3MnLCB7XHJcblx0XHRcdFx0a2V5UGF0aDogJ2lkJ1xyXG5cdFx0XHR9KTtcclxuXHRcdFx0c3RvcmUuY3JlYXRlSW5kZXgoJ25hbWUnLCAnbmFtZScpO1xyXG5cdFx0XHRzdG9yZS5jcmVhdGVJbmRleCgnaWQnLCAnaWQnLCB7XHJcblx0XHRcdFx0dW5pcXVlOiB0cnVlXHJcblx0XHRcdH0pO1xyXG5cdFx0XHRkYi5jcmVhdGVPYmplY3RTdG9yZSgncmVxdWVzdHF1ZXVlJywgIHsgYXV0b0luY3JlbWVudCA6IHRydWUgfSk7XHJcblx0XHR9O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcblx0ICovXHJcblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG5cdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcblx0XHRcdGlmIChlcnJvcikge1xyXG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG5cdFx0XHRcdGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcblx0XHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuXHRcdFx0aWYgKGVycm9yKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcblx0XHRcdFx0Y29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG5cdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcblx0XHRcdGlmIChlcnJvcikge1xyXG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xyXG5cdFx0XHRcdGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuXHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG5cdFx0XHRpZiAoZXJyb3IpIHtcclxuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Ly8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcblx0XHRcdFx0Y29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuXHRcdFx0XHQvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuXHRcdFx0XHRjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcclxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcblx0ICovXHJcblx0c3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG5cdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcblx0XHRcdGlmIChlcnJvcikge1xyXG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHQvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcblx0XHRcdFx0Y29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XHJcblx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG5cdFx0XHRcdGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpO1xyXG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuXHRcdHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG5cdFx0cmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaCA/IHJlc3RhdXJhbnQucGhvdG9ncmFwaCA6IHJlc3RhdXJhbnQuaWR9YCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcblx0ICovXHJcblx0c3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcblx0XHRjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuXHRcdFx0cG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG5cdFx0XHR0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG5cdFx0XHR1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcblx0XHRcdG1hcDogbWFwLFxyXG5cdFx0XHRhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcblx0XHR9KTtcclxuXHRcdHJldHVybiBtYXJrZXI7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgYWRkUmVxdWVzdFRvUXVldWUocmVxdWVzdCl7XHJcblx0XHRjb25zdCBEQk9wZW5SZXF1ZXN0ID0gREJIZWxwZXIuZGF0YWJhc2U7XHJcblx0XHREQkhlbHBlci51cGdhZGVJbmRleGVkREIoREJPcGVuUmVxdWVzdCk7XHJcblx0XHRpZiAoREJPcGVuUmVxdWVzdCkge1xyXG5cdFx0XHREQk9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IGV2ZW50ID0+IHtcclxuXHRcdFx0XHRjb25zdCBkYiA9IERCT3BlblJlcXVlc3QucmVzdWx0O1xyXG5cdFx0XHRcdGRiLnRyYW5zYWN0aW9uKCdyZXF1ZXN0cXVldWUnLCAncmVhZHdyaXRlJykub2JqZWN0U3RvcmUoJ3JlcXVlc3RxdWV1ZScpLnB1dChyZXF1ZXN0KTtcclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHR9XHJcblx0c3RhdGljIHNlbmRRdWV1ZWRSZXF1ZXN0cygpIHtcclxuXHRcdGNvbnN0IERCT3BlblJlcXVlc3QgPSBEQkhlbHBlci5kYXRhYmFzZTtcclxuXHRcdERCSGVscGVyLnVwZ2FkZUluZGV4ZWREQihEQk9wZW5SZXF1ZXN0KTtcclxuXHRcdGlmIChEQk9wZW5SZXF1ZXN0KSB7XHJcblx0XHRcdERCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gZXZlbnQgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IGRiID0gREJPcGVuUmVxdWVzdC5yZXN1bHQ7XHJcblx0XHRcdFx0Y29uc3Qgc3RvcmUgPSBkYi50cmFuc2FjdGlvbigncmVxdWVzdHF1ZXVlJywgJ3JlYWR3cml0ZScpLm9iamVjdFN0b3JlKCdyZXF1ZXN0cXVldWUnKTtcclxuXHRcdFx0XHRzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZXZlbnQgPT4ge1xyXG5cdFx0XHRcdFx0Y29uc3QgY3Vyc29yID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcclxuXHRcdFx0XHRcdGlmIChjdXJzb3IpIHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KGN1cnNvci52YWx1ZS51cmwsIGN1cnNvci52YWx1ZS5vcHRpb25zKTtcclxuXHRcdFx0XHRcdFx0ZmV0Y2gocmVxdWVzdCk7XHJcblx0XHRcdFx0XHRcdGN1cnNvci5kZWxldGUoKTtcclxuXHRcdFx0XHRcdFx0Y3Vyc29yLmNvbnRpbnVlKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fTtcclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuLyohIGxhenlzaXplcyAtIHY0LjAuMyAqL1xuIWZ1bmN0aW9uKGEsYil7dmFyIGM9YihhLGEuZG9jdW1lbnQpO2EubGF6eVNpemVzPWMsXCJvYmplY3RcIj09dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHMmJihtb2R1bGUuZXhwb3J0cz1jKX0od2luZG93LGZ1bmN0aW9uKGEsYil7XCJ1c2Ugc3RyaWN0XCI7aWYoYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKXt2YXIgYyxkLGU9Yi5kb2N1bWVudEVsZW1lbnQsZj1hLkRhdGUsZz1hLkhUTUxQaWN0dXJlRWxlbWVudCxoPVwiYWRkRXZlbnRMaXN0ZW5lclwiLGk9XCJnZXRBdHRyaWJ1dGVcIixqPWFbaF0saz1hLnNldFRpbWVvdXQsbD1hLnJlcXVlc3RBbmltYXRpb25GcmFtZXx8ayxtPWEucmVxdWVzdElkbGVDYWxsYmFjayxuPS9ecGljdHVyZSQvaSxvPVtcImxvYWRcIixcImVycm9yXCIsXCJsYXp5aW5jbHVkZWRcIixcIl9sYXp5bG9hZGVkXCJdLHA9e30scT1BcnJheS5wcm90b3R5cGUuZm9yRWFjaCxyPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHBbYl18fChwW2JdPW5ldyBSZWdFeHAoXCIoXFxcXHN8XilcIitiK1wiKFxcXFxzfCQpXCIpKSxwW2JdLnRlc3QoYVtpXShcImNsYXNzXCIpfHxcIlwiKSYmcFtiXX0scz1mdW5jdGlvbihhLGIpe3IoYSxiKXx8YS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLChhW2ldKFwiY2xhc3NcIil8fFwiXCIpLnRyaW0oKStcIiBcIitiKX0sdD1mdW5jdGlvbihhLGIpe3ZhciBjOyhjPXIoYSxiKSkmJmEuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwoYVtpXShcImNsYXNzXCIpfHxcIlwiKS5yZXBsYWNlKGMsXCIgXCIpKX0sdT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9Yz9oOlwicmVtb3ZlRXZlbnRMaXN0ZW5lclwiO2MmJnUoYSxiKSxvLmZvckVhY2goZnVuY3Rpb24oYyl7YVtkXShjLGIpfSl9LHY9ZnVuY3Rpb24oYSxkLGUsZixnKXt2YXIgaD1iLmNyZWF0ZUV2ZW50KFwiQ3VzdG9tRXZlbnRcIik7cmV0dXJuIGV8fChlPXt9KSxlLmluc3RhbmNlPWMsaC5pbml0Q3VzdG9tRXZlbnQoZCwhZiwhZyxlKSxhLmRpc3BhdGNoRXZlbnQoaCksaH0sdz1mdW5jdGlvbihiLGMpe3ZhciBlOyFnJiYoZT1hLnBpY3R1cmVmaWxsfHxkLnBmKT9lKHtyZWV2YWx1YXRlOiEwLGVsZW1lbnRzOltiXX0pOmMmJmMuc3JjJiYoYi5zcmM9Yy5zcmMpfSx4PWZ1bmN0aW9uKGEsYil7cmV0dXJuKGdldENvbXB1dGVkU3R5bGUoYSxudWxsKXx8e30pW2JdfSx5PWZ1bmN0aW9uKGEsYixjKXtmb3IoYz1jfHxhLm9mZnNldFdpZHRoO2M8ZC5taW5TaXplJiZiJiYhYS5fbGF6eXNpemVzV2lkdGg7KWM9Yi5vZmZzZXRXaWR0aCxiPWIucGFyZW50Tm9kZTtyZXR1cm4gY30sej1mdW5jdGlvbigpe3ZhciBhLGMsZD1bXSxlPVtdLGY9ZCxnPWZ1bmN0aW9uKCl7dmFyIGI9Zjtmb3IoZj1kLmxlbmd0aD9lOmQsYT0hMCxjPSExO2IubGVuZ3RoOyliLnNoaWZ0KCkoKTthPSExfSxoPWZ1bmN0aW9uKGQsZSl7YSYmIWU/ZC5hcHBseSh0aGlzLGFyZ3VtZW50cyk6KGYucHVzaChkKSxjfHwoYz0hMCwoYi5oaWRkZW4/azpsKShnKSkpfTtyZXR1cm4gaC5fbHNGbHVzaD1nLGh9KCksQT1mdW5jdGlvbihhLGIpe3JldHVybiBiP2Z1bmN0aW9uKCl7eihhKX06ZnVuY3Rpb24oKXt2YXIgYj10aGlzLGM9YXJndW1lbnRzO3ooZnVuY3Rpb24oKXthLmFwcGx5KGIsYyl9KX19LEI9ZnVuY3Rpb24oYSl7dmFyIGIsYz0wLGU9ZC50aHJvdHRsZURlbGF5LGc9ZC5yaWNUaW1lb3V0LGg9ZnVuY3Rpb24oKXtiPSExLGM9Zi5ub3coKSxhKCl9LGk9bSYmZz40OT9mdW5jdGlvbigpe20oaCx7dGltZW91dDpnfSksZyE9PWQucmljVGltZW91dCYmKGc9ZC5yaWNUaW1lb3V0KX06QShmdW5jdGlvbigpe2soaCl9LCEwKTtyZXR1cm4gZnVuY3Rpb24oYSl7dmFyIGQ7KGE9YT09PSEwKSYmKGc9MzMpLGJ8fChiPSEwLGQ9ZS0oZi5ub3coKS1jKSwwPmQmJihkPTApLGF8fDk+ZD9pKCk6ayhpLGQpKX19LEM9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkPTk5LGU9ZnVuY3Rpb24oKXtiPW51bGwsYSgpfSxnPWZ1bmN0aW9uKCl7dmFyIGE9Zi5ub3coKS1jO2Q+YT9rKGcsZC1hKToobXx8ZSkoZSl9O3JldHVybiBmdW5jdGlvbigpe2M9Zi5ub3coKSxifHwoYj1rKGcsZCkpfX07IWZ1bmN0aW9uKCl7dmFyIGIsYz17bGF6eUNsYXNzOlwibGF6eWxvYWRcIixsb2FkZWRDbGFzczpcImxhenlsb2FkZWRcIixsb2FkaW5nQ2xhc3M6XCJsYXp5bG9hZGluZ1wiLHByZWxvYWRDbGFzczpcImxhenlwcmVsb2FkXCIsZXJyb3JDbGFzczpcImxhenllcnJvclwiLGF1dG9zaXplc0NsYXNzOlwibGF6eWF1dG9zaXplc1wiLHNyY0F0dHI6XCJkYXRhLXNyY1wiLHNyY3NldEF0dHI6XCJkYXRhLXNyY3NldFwiLHNpemVzQXR0cjpcImRhdGEtc2l6ZXNcIixtaW5TaXplOjQwLGN1c3RvbU1lZGlhOnt9LGluaXQ6ITAsZXhwRmFjdG9yOjEuNSxoRmFjOi44LGxvYWRNb2RlOjIsbG9hZEhpZGRlbjohMCxyaWNUaW1lb3V0OjAsdGhyb3R0bGVEZWxheToxMjV9O2Q9YS5sYXp5U2l6ZXNDb25maWd8fGEubGF6eXNpemVzQ29uZmlnfHx7fTtmb3IoYiBpbiBjKWIgaW4gZHx8KGRbYl09Y1tiXSk7YS5sYXp5U2l6ZXNDb25maWc9ZCxrKGZ1bmN0aW9uKCl7ZC5pbml0JiZGKCl9KX0oKTt2YXIgRD1mdW5jdGlvbigpe3ZhciBnLGwsbSxvLHAseSxELEYsRyxILEksSixLLEwsTT0vXmltZyQvaSxOPS9eaWZyYW1lJC9pLE89XCJvbnNjcm9sbFwiaW4gYSYmIS9nbGVib3QvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksUD0wLFE9MCxSPTAsUz0tMSxUPWZ1bmN0aW9uKGEpe1ItLSxhJiZhLnRhcmdldCYmdShhLnRhcmdldCxUKSwoIWF8fDA+Unx8IWEudGFyZ2V0KSYmKFI9MCl9LFU9ZnVuY3Rpb24oYSxjKXt2YXIgZCxmPWEsZz1cImhpZGRlblwiPT14KGIuYm9keSxcInZpc2liaWxpdHlcIil8fFwiaGlkZGVuXCIhPXgoYSxcInZpc2liaWxpdHlcIik7Zm9yKEYtPWMsSSs9YyxHLT1jLEgrPWM7ZyYmKGY9Zi5vZmZzZXRQYXJlbnQpJiZmIT1iLmJvZHkmJmYhPWU7KWc9KHgoZixcIm9wYWNpdHlcIil8fDEpPjAsZyYmXCJ2aXNpYmxlXCIhPXgoZixcIm92ZXJmbG93XCIpJiYoZD1mLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGc9SD5kLmxlZnQmJkc8ZC5yaWdodCYmST5kLnRvcC0xJiZGPGQuYm90dG9tKzEpO3JldHVybiBnfSxWPWZ1bmN0aW9uKCl7dmFyIGEsZixoLGosayxtLG4scCxxLHI9Yy5lbGVtZW50cztpZigobz1kLmxvYWRNb2RlKSYmOD5SJiYoYT1yLmxlbmd0aCkpe2Y9MCxTKyssbnVsbD09SyYmKFwiZXhwYW5kXCJpbiBkfHwoZC5leHBhbmQ9ZS5jbGllbnRIZWlnaHQ+NTAwJiZlLmNsaWVudFdpZHRoPjUwMD81MDA6MzcwKSxKPWQuZXhwYW5kLEs9SipkLmV4cEZhY3RvciksSz5RJiYxPlImJlM+MiYmbz4yJiYhYi5oaWRkZW4/KFE9SyxTPTApOlE9bz4xJiZTPjEmJjY+Uj9KOlA7Zm9yKDthPmY7ZisrKWlmKHJbZl0mJiFyW2ZdLl9sYXp5UmFjZSlpZihPKWlmKChwPXJbZl1baV0oXCJkYXRhLWV4cGFuZFwiKSkmJihtPTEqcCl8fChtPVEpLHEhPT1tJiYoeT1pbm5lcldpZHRoK20qTCxEPWlubmVySGVpZ2h0K20sbj0tMSptLHE9bSksaD1yW2ZdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLChJPWguYm90dG9tKT49biYmKEY9aC50b3ApPD1EJiYoSD1oLnJpZ2h0KT49bipMJiYoRz1oLmxlZnQpPD15JiYoSXx8SHx8R3x8RikmJihkLmxvYWRIaWRkZW58fFwiaGlkZGVuXCIhPXgocltmXSxcInZpc2liaWxpdHlcIikpJiYobCYmMz5SJiYhcCYmKDM+b3x8ND5TKXx8VShyW2ZdLG0pKSl7aWYoYmEocltmXSksaz0hMCxSPjkpYnJlYWt9ZWxzZSFrJiZsJiYhaiYmND5SJiY0PlMmJm8+MiYmKGdbMF18fGQucHJlbG9hZEFmdGVyTG9hZCkmJihnWzBdfHwhcCYmKEl8fEh8fEd8fEZ8fFwiYXV0b1wiIT1yW2ZdW2ldKGQuc2l6ZXNBdHRyKSkpJiYoaj1nWzBdfHxyW2ZdKTtlbHNlIGJhKHJbZl0pO2omJiFrJiZiYShqKX19LFc9QihWKSxYPWZ1bmN0aW9uKGEpe3MoYS50YXJnZXQsZC5sb2FkZWRDbGFzcyksdChhLnRhcmdldCxkLmxvYWRpbmdDbGFzcyksdShhLnRhcmdldCxaKSx2KGEudGFyZ2V0LFwibGF6eWxvYWRlZFwiKX0sWT1BKFgpLFo9ZnVuY3Rpb24oYSl7WSh7dGFyZ2V0OmEudGFyZ2V0fSl9LCQ9ZnVuY3Rpb24oYSxiKXt0cnl7YS5jb250ZW50V2luZG93LmxvY2F0aW9uLnJlcGxhY2UoYil9Y2F0Y2goYyl7YS5zcmM9Yn19LF89ZnVuY3Rpb24oYSl7dmFyIGIsYz1hW2ldKGQuc3Jjc2V0QXR0cik7KGI9ZC5jdXN0b21NZWRpYVthW2ldKFwiZGF0YS1tZWRpYVwiKXx8YVtpXShcIm1lZGlhXCIpXSkmJmEuc2V0QXR0cmlidXRlKFwibWVkaWFcIixiKSxjJiZhLnNldEF0dHJpYnV0ZShcInNyY3NldFwiLGMpfSxhYT1BKGZ1bmN0aW9uKGEsYixjLGUsZil7dmFyIGcsaCxqLGwsbyxwOyhvPXYoYSxcImxhenliZWZvcmV1bnZlaWxcIixiKSkuZGVmYXVsdFByZXZlbnRlZHx8KGUmJihjP3MoYSxkLmF1dG9zaXplc0NsYXNzKTphLnNldEF0dHJpYnV0ZShcInNpemVzXCIsZSkpLGg9YVtpXShkLnNyY3NldEF0dHIpLGc9YVtpXShkLnNyY0F0dHIpLGYmJihqPWEucGFyZW50Tm9kZSxsPWomJm4udGVzdChqLm5vZGVOYW1lfHxcIlwiKSkscD1iLmZpcmVzTG9hZHx8XCJzcmNcImluIGEmJihofHxnfHxsKSxvPXt0YXJnZXQ6YX0scCYmKHUoYSxULCEwKSxjbGVhclRpbWVvdXQobSksbT1rKFQsMjUwMCkscyhhLGQubG9hZGluZ0NsYXNzKSx1KGEsWiwhMCkpLGwmJnEuY2FsbChqLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic291cmNlXCIpLF8pLGg/YS5zZXRBdHRyaWJ1dGUoXCJzcmNzZXRcIixoKTpnJiYhbCYmKE4udGVzdChhLm5vZGVOYW1lKT8kKGEsZyk6YS5zcmM9ZyksZiYmKGh8fGwpJiZ3KGEse3NyYzpnfSkpLGEuX2xhenlSYWNlJiZkZWxldGUgYS5fbGF6eVJhY2UsdChhLGQubGF6eUNsYXNzKSx6KGZ1bmN0aW9uKCl7KCFwfHxhLmNvbXBsZXRlJiZhLm5hdHVyYWxXaWR0aD4xKSYmKHA/VChvKTpSLS0sWChvKSl9LCEwKX0pLGJhPWZ1bmN0aW9uKGEpe3ZhciBiLGM9TS50ZXN0KGEubm9kZU5hbWUpLGU9YyYmKGFbaV0oZC5zaXplc0F0dHIpfHxhW2ldKFwic2l6ZXNcIikpLGY9XCJhdXRvXCI9PWU7KCFmJiZsfHwhY3x8IWFbaV0oXCJzcmNcIikmJiFhLnNyY3NldHx8YS5jb21wbGV0ZXx8cihhLGQuZXJyb3JDbGFzcyl8fCFyKGEsZC5sYXp5Q2xhc3MpKSYmKGI9dihhLFwibGF6eXVudmVpbHJlYWRcIikuZGV0YWlsLGYmJkUudXBkYXRlRWxlbShhLCEwLGEub2Zmc2V0V2lkdGgpLGEuX2xhenlSYWNlPSEwLFIrKyxhYShhLGIsZixlLGMpKX0sY2E9ZnVuY3Rpb24oKXtpZighbCl7aWYoZi5ub3coKS1wPDk5OSlyZXR1cm4gdm9pZCBrKGNhLDk5OSk7dmFyIGE9QyhmdW5jdGlvbigpe2QubG9hZE1vZGU9MyxXKCl9KTtsPSEwLGQubG9hZE1vZGU9MyxXKCksaihcInNjcm9sbFwiLGZ1bmN0aW9uKCl7Mz09ZC5sb2FkTW9kZSYmKGQubG9hZE1vZGU9MiksYSgpfSwhMCl9fTtyZXR1cm57XzpmdW5jdGlvbigpe3A9Zi5ub3coKSxjLmVsZW1lbnRzPWIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShkLmxhenlDbGFzcyksZz1iLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoZC5sYXp5Q2xhc3MrXCIgXCIrZC5wcmVsb2FkQ2xhc3MpLEw9ZC5oRmFjLGooXCJzY3JvbGxcIixXLCEwKSxqKFwicmVzaXplXCIsVywhMCksYS5NdXRhdGlvbk9ic2VydmVyP25ldyBNdXRhdGlvbk9ic2VydmVyKFcpLm9ic2VydmUoZSx7Y2hpbGRMaXN0OiEwLHN1YnRyZWU6ITAsYXR0cmlidXRlczohMH0pOihlW2hdKFwiRE9NTm9kZUluc2VydGVkXCIsVywhMCksZVtoXShcIkRPTUF0dHJNb2RpZmllZFwiLFcsITApLHNldEludGVydmFsKFcsOTk5KSksaihcImhhc2hjaGFuZ2VcIixXLCEwKSxbXCJmb2N1c1wiLFwibW91c2VvdmVyXCIsXCJjbGlja1wiLFwibG9hZFwiLFwidHJhbnNpdGlvbmVuZFwiLFwiYW5pbWF0aW9uZW5kXCIsXCJ3ZWJraXRBbmltYXRpb25FbmRcIl0uZm9yRWFjaChmdW5jdGlvbihhKXtiW2hdKGEsVywhMCl9KSwvZCR8XmMvLnRlc3QoYi5yZWFkeVN0YXRlKT9jYSgpOihqKFwibG9hZFwiLGNhKSxiW2hdKFwiRE9NQ29udGVudExvYWRlZFwiLFcpLGsoY2EsMmU0KSksYy5lbGVtZW50cy5sZW5ndGg/KFYoKSx6Ll9sc0ZsdXNoKCkpOlcoKX0sY2hlY2tFbGVtczpXLHVudmVpbDpiYX19KCksRT1mdW5jdGlvbigpe3ZhciBhLGM9QShmdW5jdGlvbihhLGIsYyxkKXt2YXIgZSxmLGc7aWYoYS5fbGF6eXNpemVzV2lkdGg9ZCxkKz1cInB4XCIsYS5zZXRBdHRyaWJ1dGUoXCJzaXplc1wiLGQpLG4udGVzdChiLm5vZGVOYW1lfHxcIlwiKSlmb3IoZT1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic291cmNlXCIpLGY9MCxnPWUubGVuZ3RoO2c+ZjtmKyspZVtmXS5zZXRBdHRyaWJ1dGUoXCJzaXplc1wiLGQpO2MuZGV0YWlsLmRhdGFBdHRyfHx3KGEsYy5kZXRhaWwpfSksZT1mdW5jdGlvbihhLGIsZCl7dmFyIGUsZj1hLnBhcmVudE5vZGU7ZiYmKGQ9eShhLGYsZCksZT12KGEsXCJsYXp5YmVmb3Jlc2l6ZXNcIix7d2lkdGg6ZCxkYXRhQXR0cjohIWJ9KSxlLmRlZmF1bHRQcmV2ZW50ZWR8fChkPWUuZGV0YWlsLndpZHRoLGQmJmQhPT1hLl9sYXp5c2l6ZXNXaWR0aCYmYyhhLGYsZSxkKSkpfSxmPWZ1bmN0aW9uKCl7dmFyIGIsYz1hLmxlbmd0aDtpZihjKWZvcihiPTA7Yz5iO2IrKyllKGFbYl0pfSxnPUMoZik7cmV0dXJue186ZnVuY3Rpb24oKXthPWIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShkLmF1dG9zaXplc0NsYXNzKSxqKFwicmVzaXplXCIsZyl9LGNoZWNrRWxlbXM6Zyx1cGRhdGVFbGVtOmV9fSgpLEY9ZnVuY3Rpb24oKXtGLml8fChGLmk9ITAsRS5fKCksRC5fKCkpfTtyZXR1cm4gYz17Y2ZnOmQsYXV0b1NpemVyOkUsbG9hZGVyOkQsaW5pdDpGLHVQOncsYUM6cyxyQzp0LGhDOnIsZmlyZTp2LGdXOnksckFGOnp9fX0pO1xyXG4vKmVzbGludCBuby1jb25zb2xlOiAwKi9cclxuLyplc2xpbnQgbm8tdW51c2VkLXZhcnM6IDAqL1xyXG4vKmVzbGludCBuby11bmRlZjogMCovXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcclxuXHRmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuXHRmZXRjaEN1aXNpbmVzKCk7XHJcbn0pO1xyXG5cclxubGV0IG1hcDtcclxuXHJcbi8qY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIob25JbnRlcnNlY3Rpb24sIHtcclxuXHRyb290TWFyZ2luOiAnMHB4JyxcclxuXHR0aHJlc2hvbGQ6IDAuMVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIG9uSW50ZXJzZWN0aW9uKGVudHJpZXMpIHtcclxuXHQvLyBMb29wIHRocm91Z2ggdGhlIGVudHJpZXNcclxuXHRlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xyXG5cdFx0Ly8gQXJlIHdlIGluIHZpZXdwb3J0P1xyXG5cdFx0aWYgKGVudHJ5LmludGVyc2VjdGlvblJhdGlvID4gMCkge1xyXG5cclxuXHRcdFx0Ly8gU3RvcCB3YXRjaGluZyBhbmQgbG9hZCB0aGUgaW1hZ2VcclxuXHRcdFx0b2JzZXJ2ZXIudW5vYnNlcnZlKGVudHJ5LnRhcmdldCk7XHJcblx0XHRcdGxvYWRJbWFnZShlbnRyeS50YXJnZXQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBsb2FkSW1hZ2UoaW1hZ2UpIHtcclxuXHRjb25zdCBzcmMgPSBpbWFnZS5kYXRhc2V0LnNyYztcclxuXHRmZXRjaEltYWdlKHNyYykudGhlbigoKSA9PiB7XHJcblx0XHRpbWFnZS5zcmMgPSBzcmM7XHJcblx0fSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZldGNoSW1hZ2UodXJsKSB7XHJcblx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHRcdGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XHJcblx0XHRpbWFnZS5zcmMgPSB1cmw7XHJcblx0XHRpbWFnZS5vbmxvYWQgPSByZXNvbHZlO1xyXG5cdFx0aW1hZ2Uub25lcnJvciA9IHJlamVjdDtcclxuXHR9KTtcclxufVxyXG5cclxuKi9cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmZXRjaE5laWdoYm9yaG9vZHMoKSB7XHJcblx0REJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xyXG5cdFx0aWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvclxyXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcblx0XHRcdGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxOZWlnaGJvcmhvb2RzSFRNTChuZWlnaGJvcmhvb2RzID0gdGhpcy5uZWlnaGJvcmhvb2RzKSB7XHJcblx0Y29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblx0aWYgKHNlbGVjdCkge1xyXG5cdFx0bmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcblx0XHRcdGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG5cdFx0XHRvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xyXG5cdFx0XHRvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcblx0XHRcdHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pO1xyXG5cdFx0fSk7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZldGNoQ3Vpc2luZXMoKSB7XHJcblx0REJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XHJcblx0XHRpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuXHRcdFx0ZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsQ3Vpc2luZXNIVE1MKGN1aXNpbmVzID0gdGhpcy5jdWlzaW5lcykge1xyXG5cdGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuXHRpZiAoc2VsZWN0KSB7XHJcblx0XHRjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG5cdFx0XHRjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuXHRcdFx0b3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XHJcblx0XHRcdG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcblx0XHRcdHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pO1xyXG5cdFx0fSk7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcblx0bGV0IGxvYyA9IHtcclxuXHRcdGxhdDogNDAuNzIyMjE2LFxyXG5cdFx0bG5nOiAtNzMuOTg3NTAxXHJcblx0fTtcclxuXHR0aGlzLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcblx0XHR6b29tOiAxMixcclxuXHRcdGNlbnRlcjogbG9jLFxyXG5cdFx0c2Nyb2xsd2hlZWw6IGZhbHNlXHJcblx0fSk7XHJcblx0dXBkYXRlUmVzdGF1cmFudHMoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxuZnVuY3Rpb24gdXBkYXRlUmVzdGF1cmFudHMoKSB7XHJcblx0Y29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuXHRjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG5cdGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHRjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG5cdGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcblx0Y29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG5cclxuXHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcblx0XHRpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xyXG5cdFx0XHRmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5mdW5jdGlvbiByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKSB7XHJcblx0Ly8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG5cdHRoaXMucmVzdGF1cmFudHMgPSBbXTtcclxuXHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcblx0dWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG5cdC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuXHRpZiAodGhpcy5tYXJrZXJzKSB7XHJcblx0XHR0aGlzLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuXHR9XHJcblx0dGhpcy5tYXJrZXJzID0gW107XHJcblx0dGhpcy5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59XHJcbi8qXHJcbmZ1bmN0aW9uIHN0YXJ0T2JzZXJ2ZXIoKSB7XHJcblx0Y29uc3QgaW1hZ2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJlc3RhdXJhbnQtaW1nJyk7XHJcblx0aW1hZ2VzLmZvckVhY2goaW1hZ2UgPT4ge1xyXG5cdFx0b2JzZXJ2ZXIub2JzZXJ2ZShpbWFnZSk7XHJcblx0fSk7XHJcbn0qL1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsUmVzdGF1cmFudHNIVE1MKHJlc3RhdXJhbnRzID0gdGhpcy5yZXN0YXVyYW50cykge1xyXG5cdGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuXHRyZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG5cdFx0dWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG5cdH0pO1xyXG5cdC8vc3RhcnRPYnNlcnZlcigpO1xyXG5cdGFkZE1hcmtlcnNUb01hcCgpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpIHtcclxuXHRpZiAodHlwZW9mIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd1bmRlZmluZWQnKSB7XHJcblx0XHRyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gZmFsc2U7XHJcblx0fVxyXG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHRsaS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1jYXJkJztcclxuXHJcblx0Y29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTsgLy9IZXJlIGdvZXMgdGhlIG5ldyBwaWN0dXJlIHRhZywgdGhhdCB3aWxsIGluY2x1ZGUgdGhlIDxpbWc+XHJcblx0cGljdHVyZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1waWN0dXJlJzsgLy90aGF0IGlzIGhvdyB3ZSB3aWxsIHNlcnZlIGRpZmVyZW50IHNpemVzIG9mIGltYWdlc1xyXG5cclxuXHQvL25leHQgYmxvY2sgcHJlcGFyZXMgc291cmNlIHRhZyBmb3Igc21hbGwgaW1hZ2VzXHJcblx0Y29uc3Qgc3JjU21hbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuXHRzcmNTbWFsbC5jbGFzc05hbWUgPSAnc291cmNlLXNtYWxsIGxhenlsb2FkJztcclxuXHRsZXQgcGljVXJsU21hbGwgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkuY29uY2F0KCctc21hbGwuanBnJyk7XHJcblx0bGV0IHBpY1VybE1lZGl1bSA9IHBpY1VybFNtYWxsLnJlcGxhY2UoJ3NtYWxsJywgJ21lZGl1bScpO1xyXG5cdC8vc3JjU21hbGwuc3Jjc2V0ID0gcGljVXJsU21hbGwgKyAnIDF4LCAnICsgcGljVXJsTWVkaXVtICsgJyAyeCc7XHJcblx0c3JjU21hbGwuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcscGljVXJsU21hbGwgKyAnIDF4LCAnICsgcGljVXJsTWVkaXVtICsgJyAyeCcpO1xyXG5cdHBpY3R1cmUuYXBwZW5kQ2hpbGQoc3JjU21hbGwpO1xyXG5cclxuXHQvL25leHQgYmxvY2sgcHJlcGFyZXMgc291cmNlIHRhZyBmb3IgbGFyZ2UgaW1hZ2VzXHJcblx0Y29uc3Qgc3JjTGFyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuXHRzcmNMYXJnZS5jbGFzc05hbWUgPSAnc291cmNlLWxhcmdlIGxhenlsb2FkJztcclxuXHRsZXQgcGljVXJsTGFyZ2UgPSBwaWNVcmxTbWFsbC5yZXBsYWNlKCdzbWFsbCcsICdsYXJnZScpO1xyXG5cdC8vc3JjTGFyZ2Uuc3Jjc2V0ID0gcGljVXJsTWVkaXVtICsgJyAxeCwgJyArIHBpY1VybExhcmdlICsgJyAyeCc7XHJcblx0c3JjU21hbGwuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsIHBpY1VybE1lZGl1bSArICcgMXgsICcgKyBwaWNVcmxMYXJnZSArICcgMngnKTtcclxuXHRzcmNMYXJnZS5tZWRpYSA9ICcobWluLXdpZHRoOiA3NTBweCknO1xyXG5cdHBpY3R1cmUuYXBwZW5kQ2hpbGQoc3JjTGFyZ2UpO1xyXG5cclxuXHQvL2NyZWF0aW5nIGltZyB0YWcsIGFuZCBhZGRpbmcgYWx0XHJcblx0Y29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuXHRpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcgbGF6eWxvYWQnO1xyXG5cdGltYWdlLmFsdCA9ICdJbWFnZSBvZiBcIicgKyByZXN0YXVyYW50Lm5hbWUgKyAnXCIgcmVzdGF1cmFudC4nO1xyXG5cdC8vaW1hZ2Uuc3JjID0gcGljVXJsU21hbGw7XHJcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIHBpY1VybFNtYWxsKTtcclxuXHRwaWN0dXJlLmFwcGVuZENoaWxkKGltYWdlKTtcclxuXHJcblx0Y29uc3QgaW5mb0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdGluZm9Db250YWluZXIuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW5mby1jb250YWluZXInO1xyXG5cdGluZm9Db250YWluZXIuYXBwZW5kQ2hpbGQocGljdHVyZSk7XHJcblxyXG5cdFxyXG5cdGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG5cdG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG5cdGluZm9Db250YWluZXIuYXBwZW5kQ2hpbGQobmFtZSk7XHJcblx0XHJcblx0Y29uc3QgZmF2b3JpdGVfaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuXHRjb25zdCBmYXZfaWNvbl9hcmlhX2xhYmVsID0gSlNPTi5wYXJzZShyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKSA/ICdSZW1vdmUgcmVzdGF1cmFudCAnICsgcmVzdGF1cmFudC5uYW1lICsgJ2Zyb20gZmF2b3JpdGVzLicgOiAnQWRkIHJlc3RhdXJhbnQgJyArIHJlc3RhdXJhbnQubmFtZSArICd0byBmYXZvcml0ZXMuJztcclxuXHRmYXZvcml0ZV9pY29uLmNsYXNzTmFtZSA9ICd0YXAtdGFyZ2V0IHRvcC1yaWdodCc7XHJcblx0ZmF2b3JpdGVfaWNvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBmYXZfaWNvbl9hcmlhX2xhYmVsKTtcclxuXHRmYXZvcml0ZV9pY29uLnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcclxuXHRmYXZvcml0ZV9pY29uLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xyXG5cdGZhdm9yaXRlX2ljb24uc2V0QXR0cmlidXRlKCdkYXRhLXJlc3RpZCcsIHJlc3RhdXJhbnQuaWQpO1xyXG5cdGZhdm9yaXRlX2ljb24uc2V0QXR0cmlidXRlKCdpcy1mYXZvcml0ZScsIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpO1xyXG5cdGZhdm9yaXRlX2ljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVGYXZvcml0ZSwgZmFsc2UpO1xyXG5cdGluZm9Db250YWluZXIuYXBwZW5kQ2hpbGQoZmF2b3JpdGVfaWNvbik7XHJcblxyXG5cdGNvbnN0IGZhdm9yaXRlX3N5bWJvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcclxuXHRmYXZvcml0ZV9zeW1ib2wuY2xhc3NOYW1lID0gJ21hdGVyaWFsLWljb25zIGZhdm9yaXRlLWljb24nO1xyXG5cdGZhdm9yaXRlX3N5bWJvbC5pbm5lckhUTUwgPSBKU09OLnBhcnNlKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpID8gJ2Zhdm9yaXRlJyA6J2Zhdm9yaXRlX2JvcmRlcic7XHJcblx0ZmF2b3JpdGVfaWNvbi5hcHBlbmRDaGlsZChmYXZvcml0ZV9zeW1ib2wpO1xyXG5cdFxyXG5cdGNvbnN0IGFkZHJlc3NDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRhZGRyZXNzQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdhZGRyZXNzLWNvbnRhaW5lcic7XHJcblxyXG5cdGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuXHRuZWlnaGJvcmhvb2Quc2V0QXR0cmlidXRlKCdhcmlhLWRlc2NyaWJlZGJ5JywgJ3Jlc3RhdXJhbnQtbmVpZ2hib3Job29kLWxhYmVsJyk7XHJcblx0bmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG5cdGFkZHJlc3NDb250YWluZXIuYXBwZW5kQ2hpbGQobmVpZ2hib3Job29kKTtcclxuXHJcblx0Y29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuXHRhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuXHRhZGRyZXNzLnNldEF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScsICdyZXN0YXVyYW50LWFkZHJlc3MtbGFiZWwnKTtcclxuXHRhZGRyZXNzQ29udGFpbmVyLmFwcGVuZENoaWxkKGFkZHJlc3MpO1xyXG5cclxuXHRpbmZvQ29udGFpbmVyLmFwcGVuZENoaWxkKGFkZHJlc3NDb250YWluZXIpO1xyXG5cclxuXHRsaS5hcHBlbmRDaGlsZChpbmZvQ29udGFpbmVyKTtcclxuXHJcblx0Y29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuXHRtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xyXG5cdG1vcmUuY2xhc3NOYW1lID0gJ3RhcC10YXJnZXQgcmVzdGF1cmFudC1jYXJkLWRldGFpbHMnO1xyXG5cdG1vcmUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1Jlc3RhdXJhbnQ6ICcgKyByZXN0YXVyYW50Lm5hbWUgKyAnOiB2aWV3IGRldGFpbHMuJyk7XHJcblx0bW9yZS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XHJcblx0bW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuXHRsaS5hcHBlbmRDaGlsZChtb3JlKTtcclxuXHJcblx0cmV0dXJuIGxpO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmZ1bmN0aW9uIGFkZE1hcmtlcnNUb01hcChyZXN0YXVyYW50cyA9IHRoaXMucmVzdGF1cmFudHMpIHtcclxuXHRyZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG5cdFx0Ly8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcblx0XHRjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHRoaXMubWFwKTtcclxuXHRcdGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xyXG5cdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmw7XHJcblx0XHR9KTtcclxuXHRcdHRoaXMubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcblx0fSk7XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiB0b2dnbGVGYXZvcml0ZShlKSB7XHJcblx0aWYgKCFlKVxyXG5cdFx0ZSA9IHdpbmRvdy5ldmVudDtcclxuXHRjb25zdCBzZW5kZXIgPSBlLnNyY0VsZW1lbnQgfHwgZS50YXJnZXQ7XHJcblx0Y29uc3QgaWQgPSB0aGlzLmRhdGFzZXQucmVzdGlkO1xyXG5cdC8vSW52ZXJ0aW5nIHZhbHVlIGluIHRlIG5leHQgbGluZVxyXG5cdGxldCBzdGF0ZSA9IEpTT04ucGFyc2UodGhpcy5nZXRBdHRyaWJ1dGUoJ2lzLWZhdm9yaXRlJykpID8gZmFsc2UgOiB0cnVlO1xyXG5cdFxyXG5cdGlmKGlkKXtcclxuXHRcdHRoaXMuc2V0QXR0cmlidXRlKCdpcy1mYXZvcml0ZScsc3RhdGUpO1xyXG5cdFx0REJIZWxwZXIuc2V0UmVzdGF1cmFudEZhdm9yaXRlKGlkLCBzdGF0ZSk7XHJcblx0XHRpZihzZW5kZXIgPT0gdGhpcyl7XHJcblx0XHRcdGlmKHRoaXMuY2hpbGROb2Rlcy5sZW5ndGggPiAwKXtcclxuXHRcdFx0XHR0aGlzLmNoaWxkTm9kZXNbMF0uaW5uZXJIVE1MID0gc3RhdGUgPyAnZmF2b3JpdGUnIDonZmF2b3JpdGVfYm9yZGVyJztcclxuXHRcdFx0fVxyXG5cdFx0fWVsc2V7XHJcblx0XHRcdHNlbmRlci5pbm5lckhUTUwgPSBzdGF0ZSA/ICdmYXZvcml0ZScgOidmYXZvcml0ZV9ib3JkZXInO1xyXG5cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuLyplc2xpbnQgbm8tY29uc29sZTogMCovXHJcbi8qZXNsaW50IG5vLXVudXNlZC12YXJzOiAwKi9cclxuLyplc2xpbnQgbm8tdW5kZWY6IDAqL1xyXG5cclxubGV0IHJlc3RhdXJhbnQ7XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXBEZXRhaWxzID0gKCkgPT4ge1xyXG5cdGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcblx0XHRpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG5cdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuXHRcdFx0XHR6b29tOiAxNixcclxuXHRcdFx0XHRjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxyXG5cdFx0XHRcdHNjcm9sbHdoZWVsOiBmYWxzZVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0ZmlsbEJyZWFkY3J1bWIoKTtcclxuXHRcdFx0REJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuXHRcdH1cclxuXHR9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKGNhbGxiYWNrKXtcclxuXHRpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxyXG5cdFx0Y2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KTtcclxuXHRcdHJldHVybjtcclxuXHR9XHJcblx0Y29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XHJcblx0aWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcclxuXHRcdGNhbGxiYWNrKCdObyByZXN0YXVyYW50IGlkIGluIFVSTCcsIG51bGwpO1xyXG5cdH0gZWxzZSB7XHJcblx0XHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuXHRcdFx0c2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcclxuXHRcdFx0aWYgKCFyZXN0YXVyYW50KSB7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcik7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHRcdGZpbGxSZXN0YXVyYW50SFRNTCgpO1xyXG5cdFx0XHRjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuXHRcdH0pO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpe1xyXG4gIFxyXG5cdGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XHJcblx0bmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgXHJcblx0Y29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcclxuXHRhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBcclxuXHRjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xyXG5cdGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcblx0bGV0IHBpY1VybFNtYWxsID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLmNvbmNhdCgnLXNtYWxsLmpwZycpO1xyXG5cdC8vaW1hZ2Uuc3JjID0gcGljVXJsU21hbGw7XHJcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIHBpY1VybFNtYWxsKTtcclxuXHRpbWFnZS5hbHQgPSAnSW1hZ2Ugb2YgXCInICsgcmVzdGF1cmFudC5uYW1lICsgJ1wiIHJlc3RhdXJhbnQuJztcclxuICBcclxuXHRjb25zdCBzcmNTbWFsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2Utc21hbGwnKTtcclxuXHRsZXQgcGljVXJsTWVkaXVtID0gcGljVXJsU21hbGwucmVwbGFjZSgnc21hbGwnLCdtZWRpdW0nKTtcclxuXHRzcmNTbWFsbC5zcmNzZXQgPSBwaWNVcmxTbWFsbCArICcgMXgsICcgKyBwaWNVcmxNZWRpdW0gKyAnIDJ4JztcclxuICBcclxuXHRjb25zdCBzcmNMYXJnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2UtbGFyZ2UnKTtcclxuXHRsZXQgcGljVXJsTGFyZ2UgPSBwaWNVcmxTbWFsbC5yZXBsYWNlKCdzbWFsbCcsJ2xhcmdlJyk7XHJcblx0c3JjTGFyZ2Uuc3Jjc2V0ID0gcGljVXJsTWVkaXVtICsgJyAxeCwgJyArIHBpY1VybExhcmdlICsgJyAyeCc7XHJcblxyXG5cdC8vY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LXBpY3R1cmUnKTtcclxuXHJcblx0Y29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcclxuXHRjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xyXG5cclxuXHQvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xyXG5cdGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xyXG5cdFx0ZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcclxuXHR9XHJcblx0Ly8gZmlsbCByZXZpZXdzXHJcblx0ZmlsbFJldmlld3NIVE1MKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycyl7XHJcblx0Y29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xyXG5cdGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG5cdFx0Y29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuXHJcblx0XHRjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG5cdFx0ZGF5LmlubmVySFRNTCA9IGtleTtcclxuXHRcdGRheS5jbGFzc05hbWUgPSAndGFibGUtZGF5JztcclxuXHRcdHJvdy5hcHBlbmRDaGlsZChkYXkpO1xyXG5cclxuXHRcdGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG5cdFx0dGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG5cdFx0dGltZS5jbGFzc05hbWUgPSAndGFibGUtdGltZSc7XHJcblx0XHRyb3cuYXBwZW5kQ2hpbGQodGltZSk7XHJcblxyXG5cdFx0aG91cnMuYXBwZW5kQ2hpbGQocm93KTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBzdWJtaXRSZXZpZXcgLSBzdWJtaXRzIGEgcmV2aWV3IHRvIHRoZSBkYXRhYmFzZVxyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gc3VibWl0UmV2aWV3KGUpIHtcclxuXHRpZiAoIWUpXHJcblx0XHRlID0gd2luZG93LmV2ZW50O1xyXG5cdGNvbnN0IHNlbmRlciA9IGUuc3JjRWxlbWVudCB8fCBlLnRhcmdldDtcclxuXHRjb25zdCBpZCA9IHNlbmRlci5nZXRBdHRyaWJ1dGUoJ3Jlc3RhdXJhbnQtaWQnKTtcclxuXHRjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy1uYW1lJykudmFsdWU7XHJcblx0Y29uc3QgY29tbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXctdGV4dCcpLnZhbHVlO1xyXG5cdGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXctcmF0aW5nJykudmFsdWU7XHJcblx0aWYobmFtZSAmJiBjb21tZW50KXtcclxuXHRcdGNvbnN0IGRhdGEgPSB7XHJcblx0XHRcdCdyZXN0YXVyYW50X2lkJzogaWQsXHJcblx0XHRcdCduYW1lJzogbmFtZSxcclxuXHRcdFx0J3JhdGluZyc6IHJhdGluZyxcclxuXHRcdFx0J2NvbW1lbnRzJzogY29tbWVudCxcclxuXHRcdFx0J2NyZWF0ZWRBdCc6IChuZXcgRGF0ZSgpKS5nZXRUaW1lKClcclxuXHRcdH07XHJcblx0XHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuXHRcdHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwoZGF0YSkpO1xyXG5cdFx0Y29uc3QgcmV2aWV3ID0gREJIZWxwZXIuYWRkUmVzdGF1cmFudFJldmlldyhkYXRhKTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsUmV2aWV3c0hUTUwocmV2aWV3cyA9IHNlbGYucmVzdGF1cmFudC5yZXZpZXdzLCBpZCA9IHNlbGYucmVzdGF1cmFudC5pZCkge1xyXG5cdGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xyXG5cdGlmICghcmV2aWV3cykge1xyXG5cdFx0Y29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG5cdFx0bm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xyXG5cdFx0Y29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cdGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtY29tbWVudCcpO1xyXG5cdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3Jlc3RhdXJhbnQtaWQnLCBpZCk7XHJcblx0YnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc3VibWl0UmV2aWV3LCBmYWxzZSk7XHJcblx0Y29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XHJcblx0cmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcblx0XHR1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xyXG5cdH0pO1xyXG5cdGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KXtcclxuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuXHRuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG5cdGxpLmFwcGVuZENoaWxkKG5hbWUpO1xyXG5cclxuXHRjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG5cdC8vY29uc3QgY3JlYXRlZERhdGUgPSBuZXcgRGF0ZShyZXZpZXcuY3JlYXRlZEF0KTtcclxuXHRkYXRlLmlubmVySFRNTCA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xyXG5cdGxpLmFwcGVuZENoaWxkKGRhdGUpO1xyXG5cclxuXHRjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcblx0cmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG5cdGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XHJcblxyXG5cdGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG5cdGNvbW1lbnRzLmNsYXNzTmFtZSA9ICdyZXZpZXctY29tbWVudHMnO1xyXG5cdGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcclxuXHRsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XHJcblxyXG5cdHJldHVybiBsaTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsQnJlYWRjcnVtYihyZXN0YXVyYW50PXNlbGYucmVzdGF1cmFudCkge1xyXG5cdGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xyXG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHRsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcblx0YnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUsIHVybCl7XHJcblx0aWYgKCF1cmwpXHJcblx0XHR1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuXHRuYW1lID0gbmFtZS5yZXBsYWNlKC9bW1xcXV0vZywgJ1xcXFwkJicpO1xyXG5cdGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxyXG5cdFx0cmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcclxuXHRpZiAoIXJlc3VsdHMpXHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHRpZiAoIXJlc3VsdHNbMl0pXHJcblx0XHRyZXR1cm4gJyc7XHJcblx0cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcclxufVxyXG5cclxuLyplc2xpbnQgbm8tY29uc29sZTogMCovXHJcbi8qZXNsaW50IG5vLXVuZGVmOiAwKi9cclxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuXHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHlsZXMnKS5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XHJcblxyXG5cdFx0aWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNtYXAnKS5sZW5ndGggPiAwKSB7XHJcblx0XHRcdGNvbnN0IGpzX2ZpbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcclxuXHRcdFx0anNfZmlsZS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XHJcblx0XHRcdGpzX2ZpbGUuc3JjID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9qcz9rZXk9QUl6YVN5RFpPSnRLVlR5RWN6LVJWVnI0YWVQc2ViRVBBUDlKWWF3JmxpYnJhcmllcz1wbGFjZXMmY2FsbGJhY2s9aW5pdE1hcCc7XHJcblx0XHRcdGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0uYXBwZW5kQ2hpbGQoanNfZmlsZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0bmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3N3LmpzJykudGhlbigoKSA9PiB7XHJcblx0XHRcdGNvbnNvbGUubG9nKCdTZXJ2aWNlIFdvcmtlciBSZWdpc3RlcmQnKTtcclxuXHRcdH0pLmNhdGNoKChlKSA9PiB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZSk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgREJIZWxwZXIuc2VuZFF1ZXVlZFJlcXVlc3RzLCBmYWxzZSk7XHJcbn0iXSwiZmlsZSI6ImFsbC5qcyJ9
