class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/"}static get RESTAURANT_URL(){return`${this.DATABASE_URL}restaurants/`}static get REVIEW_URL(){return`${this.DATABASE_URL}reviews/`}static get database(){if(!navigator.serviceWorker)return Promise.resolve();return(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB).open("rreviews",1)}static fetchRestaurants(e){fetch(DBHelper.RESTAURANT_URL).then(e=>e.json()).then(t=>{DBHelper.storeRestaurantDataInIndexedDB(t),e(null,t)}).catch(t=>{DBHelper.getRestaurantDataFromIndexedDB().then(t=>{e(null,t)})})}static fetchRestaurantById(e,t){const n=`${this.REVIEW_URL}?restaurant_id=${e}`,a=DBHelper.database;DBHelper.upgadeIndexedDB(a),a&&(a.onsuccess=(r=>{const s=a.result;s.transaction(["rreviews"],"readwrite").objectStore("rreviews").index("id").openCursor().onsuccess=(a=>{const r=a.target.result;if(r)if(r.value.id==e){const e=r.value;fetch(n).then(e=>e.json()).then(n=>{e.reviews=n,s.transaction(["rreviews"],"readwrite").objectStore("rreviews").put(e),t(null,e)}).catch(n=>{t(null,e)})}else r.continue()})}))}static storeRestaurantDataInIndexedDB(e){const t=DBHelper.database;DBHelper.upgadeIndexedDB(t),t&&(t.onsuccess=(n=>{const a=t.result.transaction("rreviews","readwrite").objectStore("rreviews");e.forEach(e=>{a.put(e)})}))}static setRestaurantFavorite(e,t){const n=DBHelper.database;DBHelper.upgadeIndexedDB(n),n&&(n.onsuccess=(a=>{const r=n.result.transaction(["rreviews"],"readwrite").objectStore("rreviews").index("id"),s=`${this.RESTAURANT_URL}${e}/?is_favorite=${t}`;r.openCursor().onsuccess=(n=>{const a=n.target.result;if(a)if(a.value.id==e){a.value.is_favorite=t,a.update(a.value);const e=new Request(s,{method:"PUT"});fetch(e).catch(e=>{navigator.onLine||this.addRequestToQueue({url:s,options:{method:"PUT"}})})}else a.continue()})}))}static addRestaurantReview(e){const t=new Request(this.REVIEW_URL,{body:JSON.stringify(e),method:"POST"});fetch(t).then(e=>e.json()).then(t=>{this.fetchRestaurantById(e.restaurant_id,{})}).catch(t=>{navigator.onLine||this.addRequestToQueue({url:this.REVIEW_URL,options:{body:JSON.stringify(e),method:"POST"}}),this.fetchRestaurantById(e.restaurant_id,(t,n)=>{n.reviews.push(e);const a=DBHelper.database;DBHelper.upgadeIndexedDB(a),a&&(a.onsuccess=(e=>{a.result.transaction(["rreviews"],"readwrite").objectStore("rreviews").put(n)}))})})}static getRestaurantDataFromIndexedDB(){return new Promise((e,t)=>{const n=DBHelper.database;DBHelper.upgadeIndexedDB(n),n&&(n.onsuccess=(t=>{const a=[];n.result.transaction("rreviews","readonly").objectStore("rreviews").openCursor().onsuccess=(t=>{const n=t.target.result;n?(a.push(n.value),n.continue()):e(a)})}))})}static upgadeIndexedDB(e){e.onupgradeneeded=function(){const t=e.result,n=t.createObjectStore("rreviews",{keyPath:"id"});n.createIndex("name","name"),n.createIndex("id","id",{unique:!0}),t.createObjectStore("requestqueue",{autoIncrement:!0})}}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((a,r)=>{if(a)n(a,null);else{let a=r;"all"!=e&&(a=a.filter(t=>t.cuisine_type==e)),"all"!=t&&(a=a.filter(e=>e.neighborhood==t)),n(null,a)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph?e.photograph:e.id}`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}static addRequestToQueue(e){const t=DBHelper.database;DBHelper.upgadeIndexedDB(t),t&&(t.onsuccess=(n=>{t.result.transaction("requestqueue","readwrite").objectStore("requestqueue").put(e)}))}static sendQueuedRequests(){const e=DBHelper.database;DBHelper.upgadeIndexedDB(e),e&&(e.onsuccess=(t=>{e.result.transaction("requestqueue","readwrite").objectStore("requestqueue").openCursor().onsuccess=(e=>{const t=e.target.result;if(t){const e=new Request(t.value.url,t.value.options);fetch(e),t.delete(),t.continue()}})}))}}let map,restaurant;function fetchNeighborhoods(){DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(this.neighborhoods=t,fillNeighborhoodsHTML())})}function fillNeighborhoodsHTML(e=this.neighborhoods){const t=document.getElementById("neighborhoods-select");t&&e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.appendChild(n)})}function fetchCuisines(){DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(this.cuisines=t,fillCuisinesHTML())})}function fillCuisinesHTML(e=this.cuisines){const t=document.getElementById("cuisines-select");t&&e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.appendChild(n)})}function updateRestaurants(){const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,r=e[n].value,s=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}function resetRestaurants(e){this.restaurants=[],document.getElementById("restaurants-list").innerHTML="",this.markers&&this.markers.forEach(e=>e.setMap(null)),this.markers=[],this.restaurants=e}function fillRestaurantsHTML(e=this.restaurants){const t=document.getElementById("restaurants-list");e.forEach(e=>{t.appendChild(createRestaurantHTML(e))}),"undefined"!=typeof google&&addMarkersToMap()}function createRestaurantHTML(e){void 0===e.is_favorite&&(e.is_favorite=!1);const t=document.createElement("li");t.className="restaurant-card";const n=document.createElement("picture");n.className="restaurant-picture";const a=document.createElement("source");a.className="lazyload source-small";let r=DBHelper.imageUrlForRestaurant(e).concat("-small.jpg"),s=r.replace("small","medium");a.setAttribute("data-srcset",r+" 1x, "+s+" 2x"),n.appendChild(a);const i=document.createElement("source");i.className="lazyload source-large";let o=r.replace("small","large");i.setAttribute("data-srcset",s+" 1x, "+o+" 2x"),i.media="(min-width: 750px)",n.appendChild(i);const l=document.createElement("img");l.className="lazyload restaurant-img",l.alt='Image of "'+e.name+'" restaurant.',l.setAttribute("data-src",r),n.appendChild(l);const c=document.createElement("div");c.className="restaurant-info-container",c.appendChild(n);const d=document.createElement("h2");d.innerHTML=e.name,c.appendChild(d);const u=document.createElement("a"),m=JSON.parse(e.is_favorite)?"Remove restaurant "+e.name+"from favorites.":"Add restaurant "+e.name+"to favorites.";u.className="tap-target top-right",u.setAttribute("aria-label",m),u.setAttribute("role","button"),u.setAttribute("tabindex","0"),u.setAttribute("data-restid",e.id),u.setAttribute("is-favorite",e.is_favorite),u.addEventListener("click",toggleFavorite,!1),c.appendChild(u);const f=document.createElement("i");f.className="material-icons favorite-icon",f.innerHTML=JSON.parse(e.is_favorite)?"favorite":"favorite_border",u.appendChild(f);const p=document.createElement("div");p.className="address-container";const h=document.createElement("p");h.setAttribute("aria-describedby","restaurant-neighborhood-label"),h.innerHTML=e.neighborhood,p.appendChild(h);const g=document.createElement("p");g.innerHTML=e.address,g.setAttribute("aria-describedby","restaurant-address-label"),p.appendChild(g),c.appendChild(p),t.appendChild(c);const v=document.createElement("a");return v.innerHTML="View Details",v.className="tap-target restaurant-card-details",v.setAttribute("aria-label","Restaurant: "+e.name+": view details."),v.setAttribute("role","button"),v.href=DBHelper.urlForRestaurant(e),t.appendChild(v),t}function addMarkersToMap(e=this.restaurants){e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,this.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),this.markers.push(t)})}function toggleFavorite(e){e||(e=window.event);const t=e.srcElement||e.target,n=this.dataset.restid;let a=!JSON.parse(this.getAttribute("is-favorite"));n&&(this.setAttribute("is-favorite",a),DBHelper.setRestaurantFavorite(n,a),t==this?this.childNodes.length>0&&(this.childNodes[0].innerHTML=a?"favorite":"favorite_border"):t.innerHTML=a?"favorite":"favorite_border")}function fetchRestaurantFromURL(e){if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):e("No restaurant id in URL",null)}function fillRestaurantHTML(e=self.restaurant){document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img";let n=DBHelper.imageUrlForRestaurant(e).concat("-small.jpg");t.setAttribute("data-src",n),t.alt='Image of "'+e.name+'" restaurant.';const a=document.getElementById("source-small");let r=n.replace("small","medium");a.srcset=n+" 1x, "+r+" 2x";const s=document.getElementById("source-large");let i=n.replace("small","large");s.srcset=r+" 1x, "+i+" 2x",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}function fillRestaurantHoursHTML(e=self.restaurant.operating_hours){const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,r.className="table-day",a.appendChild(r);const s=document.createElement("td");s.innerHTML=e[n],s.className="table-time",a.appendChild(s),t.appendChild(a)}}function submitReview(e){e||(e=window.event);const t=(e.srcElement||e.target).getAttribute("restaurant-id"),n=document.getElementById("review-name").value,a=document.getElementById("review-text").value,r=document.getElementById("review-rating").value;if(n&&a){const e={restaurant_id:t,name:n,rating:r,comments:a,createdAt:(new Date).getTime()};document.getElementById("reviews-list").appendChild(createReviewHTML(e));DBHelper.addRestaurantReview(e)}}function fillReviewsHTML(e=self.restaurant.reviews,t=self.restaurant.id){const n=document.getElementById("reviews-container");if(!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void n.appendChild(e)}const a=document.getElementById("add-comment");a.setAttribute("restaurant-id",t),a.addEventListener("click",submitReview,!1);const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),n.appendChild(r)}function createReviewHTML(e){const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const a=document.createElement("p");a.innerHTML=new Date(e.createdAt).toLocaleDateString(),t.appendChild(a);const r=document.createElement("p");r.innerHTML=`Rating: ${e.rating}`,t.appendChild(r);const s=document.createElement("p");return s.className="review-comments",s.innerHTML=e.comments,t.appendChild(s),t}function fillBreadcrumb(e=self.restaurant){const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}!function(e,t){var n=function(e,t){"use strict";if(t.getElementsByClassName){var n,a,r=t.documentElement,s=e.Date,i=e.HTMLPictureElement,o="addEventListener",l="getAttribute",c=e[o],d=e.setTimeout,u=e.requestAnimationFrame||d,m=e.requestIdleCallback,f=/^picture$/i,p=["load","error","lazyincluded","_lazyloaded"],h={},g=Array.prototype.forEach,v=function(e,t){return h[t]||(h[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),h[t].test(e[l]("class")||"")&&h[t]},b=function(e,t){v(e,t)||e.setAttribute("class",(e[l]("class")||"").trim()+" "+t)},y=function(e,t){var n;(n=v(e,t))&&e.setAttribute("class",(e[l]("class")||"").replace(n," "))},w=function(e,t,n){var a=n?o:"removeEventListener";n&&w(e,t),p.forEach(function(n){e[a](n,t)})},E=function(e,a,r,s,i){var o=t.createEvent("CustomEvent");return r||(r={}),r.instance=n,o.initCustomEvent(a,!s,!i,r),e.dispatchEvent(o),o},B=function(t,n){var r;!i&&(r=e.picturefill||a.pf)?r({reevaluate:!0,elements:[t]}):n&&n.src&&(t.src=n.src)},R=function(e,t){return(getComputedStyle(e,null)||{})[t]},H=function(e,t,n){for(n=n||e.offsetWidth;n<a.minSize&&t&&!e._lazysizesWidth;)n=t.offsetWidth,t=t.parentNode;return n},C=function(){var e,n,a=[],r=[],s=a,i=function(){var t=s;for(s=a.length?r:a,e=!0,n=!1;t.length;)t.shift()();e=!1},o=function(a,r){e&&!r?a.apply(this,arguments):(s.push(a),n||(n=!0,(t.hidden?d:u)(i)))};return o._lsFlush=i,o}(),D=function(e,t){return t?function(){C(e)}:function(){var t=this,n=arguments;C(function(){e.apply(t,n)})}},L=function(e){var t,n=0,r=a.throttleDelay,i=a.ricTimeout,o=function(){t=!1,n=s.now(),e()},l=m&&i>49?function(){m(o,{timeout:i}),i!==a.ricTimeout&&(i=a.ricTimeout)}:D(function(){d(o)},!0);return function(e){var a;(e=!0===e)&&(i=33),t||(t=!0,0>(a=r-(s.now()-n))&&(a=0),e||9>a?l():d(l,a))}},M=function(e){var t,n,a=function(){t=null,e()},r=function(){var e=s.now()-n;99>e?d(r,99-e):(m||a)(a)};return function(){n=s.now(),t||(t=d(r,99))}};!function(){var t,n={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(t in a=e.lazySizesConfig||e.lazysizesConfig||{},n)t in a||(a[t]=n[t]);e.lazySizesConfig=a,d(function(){a.init&&I()})}();var T=function(){var i,u,m,p,h,H,T,I,z,N,x,_,S,k,F=/^img$/i,U=/^iframe$/i,q="onscroll"in e&&!/glebot/.test(navigator.userAgent),O=0,W=0,$=-1,j=function(e){W--,e&&e.target&&w(e.target,j),(!e||0>W||!e.target)&&(W=0)},P=function(e,n){var a,s=e,i="hidden"==R(t.body,"visibility")||"hidden"!=R(e,"visibility");for(I-=n,x+=n,z-=n,N+=n;i&&(s=s.offsetParent)&&s!=t.body&&s!=r;)(i=(R(s,"opacity")||1)>0)&&"visible"!=R(s,"overflow")&&(a=s.getBoundingClientRect(),i=N>a.left&&z<a.right&&x>a.top-1&&I<a.bottom+1);return i},J=function(){var e,s,o,c,d,m,f,h,g,v=n.elements;if((p=a.loadMode)&&8>W&&(e=v.length)){s=0,$++,null==S&&("expand"in a||(a.expand=r.clientHeight>500&&r.clientWidth>500?500:370),_=a.expand,S=_*a.expFactor),S>O&&1>W&&$>2&&p>2&&!t.hidden?(O=S,$=0):O=p>1&&$>1&&6>W?_:0;for(;e>s;s++)if(v[s]&&!v[s]._lazyRace)if(q)if((h=v[s][l]("data-expand"))&&(m=1*h)||(m=O),g!==m&&(H=innerWidth+m*k,T=innerHeight+m,f=-1*m,g=m),o=v[s].getBoundingClientRect(),(x=o.bottom)>=f&&(I=o.top)<=T&&(N=o.right)>=f*k&&(z=o.left)<=H&&(x||N||z||I)&&(a.loadHidden||"hidden"!=R(v[s],"visibility"))&&(u&&3>W&&!h&&(3>p||4>$)||P(v[s],m))){if(Z(v[s]),d=!0,W>9)break}else!d&&u&&!c&&4>W&&4>$&&p>2&&(i[0]||a.preloadAfterLoad)&&(i[0]||!h&&(x||N||z||I||"auto"!=v[s][l](a.sizesAttr)))&&(c=i[0]||v[s]);else Z(v[s]);c&&!d&&Z(c)}},Q=L(J),V=function(e){b(e.target,a.loadedClass),y(e.target,a.loadingClass),w(e.target,K),E(e.target,"lazyloaded")},G=D(V),K=function(e){G({target:e.target})},X=function(e){var t,n=e[l](a.srcsetAttr);(t=a.customMedia[e[l]("data-media")||e[l]("media")])&&e.setAttribute("media",t),n&&e.setAttribute("srcset",n)},Y=D(function(e,t,n,r,s){var i,o,c,u,p,h;(p=E(e,"lazybeforeunveil",t)).defaultPrevented||(r&&(n?b(e,a.autosizesClass):e.setAttribute("sizes",r)),o=e[l](a.srcsetAttr),i=e[l](a.srcAttr),s&&(c=e.parentNode,u=c&&f.test(c.nodeName||"")),h=t.firesLoad||"src"in e&&(o||i||u),p={target:e},h&&(w(e,j,!0),clearTimeout(m),m=d(j,2500),b(e,a.loadingClass),w(e,K,!0)),u&&g.call(c.getElementsByTagName("source"),X),o?e.setAttribute("srcset",o):i&&!u&&(U.test(e.nodeName)?function(e,t){try{e.contentWindow.location.replace(t)}catch(n){e.src=t}}(e,i):e.src=i),s&&(o||u)&&B(e,{src:i})),e._lazyRace&&delete e._lazyRace,y(e,a.lazyClass),C(function(){(!h||e.complete&&e.naturalWidth>1)&&(h?j(p):W--,V(p))},!0)}),Z=function(e){var t,n=F.test(e.nodeName),r=n&&(e[l](a.sizesAttr)||e[l]("sizes")),s="auto"==r;(!s&&u||!n||!e[l]("src")&&!e.srcset||e.complete||v(e,a.errorClass)||!v(e,a.lazyClass))&&(t=E(e,"lazyunveilread").detail,s&&A.updateElem(e,!0,e.offsetWidth),e._lazyRace=!0,W++,Y(e,t,s,r,n))},ee=function(){if(!u){if(s.now()-h<999)return void d(ee,999);var e=M(function(){a.loadMode=3,Q()});u=!0,a.loadMode=3,Q(),c("scroll",function(){3==a.loadMode&&(a.loadMode=2),e()},!0)}};return{_:function(){h=s.now(),n.elements=t.getElementsByClassName(a.lazyClass),i=t.getElementsByClassName(a.lazyClass+" "+a.preloadClass),k=a.hFac,c("scroll",Q,!0),c("resize",Q,!0),e.MutationObserver?new MutationObserver(Q).observe(r,{childList:!0,subtree:!0,attributes:!0}):(r[o]("DOMNodeInserted",Q,!0),r[o]("DOMAttrModified",Q,!0),setInterval(Q,999)),c("hashchange",Q,!0),["focus","mouseover","click","load","transitionend","animationend","webkitAnimationEnd"].forEach(function(e){t[o](e,Q,!0)}),/d$|^c/.test(t.readyState)?ee():(c("load",ee),t[o]("DOMContentLoaded",Q),d(ee,2e4)),n.elements.length?(J(),C._lsFlush()):Q()},checkElems:Q,unveil:Z}}(),A=function(){var e,n=D(function(e,t,n,a){var r,s,i;if(e._lazysizesWidth=a,a+="px",e.setAttribute("sizes",a),f.test(t.nodeName||""))for(r=t.getElementsByTagName("source"),s=0,i=r.length;i>s;s++)r[s].setAttribute("sizes",a);n.detail.dataAttr||B(e,n.detail)}),r=function(e,t,a){var r,s=e.parentNode;s&&(a=H(e,s,a),(r=E(e,"lazybeforesizes",{width:a,dataAttr:!!t})).defaultPrevented||(a=r.detail.width)&&a!==e._lazysizesWidth&&n(e,s,r,a))},s=M(function(){var t,n=e.length;if(n)for(t=0;n>t;t++)r(e[t])});return{_:function(){e=t.getElementsByClassName(a.autosizesClass),c("resize",s)},checkElems:s,updateElem:r}}(),I=function(){I.i||(I.i=!0,A._(),T._())};return n={cfg:a,autoSizer:A,loader:T,init:I,uP:B,aC:b,rC:y,hC:v,fire:E,gW:H,rAF:C}}}(e,e.document);e.lazySizes=n,"object"==typeof module&&module.exports&&(module.exports=n)}(window),document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines()}),window.initMap=(()=>{let e={lat:40.722216,lng:-73.987501};"undefined"!=typeof google&&(this.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:e,scrollwheel:!1})),updateRestaurants()}),window.initMapDetails=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):("undefined"!=typeof google&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)),fillBreadcrumb())})}),"serviceWorker"in navigator&&(window.addEventListener("load",()=>{document.getElementById("styles").removeAttribute("disabled"),-1==window.location.href.indexOf("restaurant.html")?(navigator.serviceWorker.register("sw.js").then(()=>{console.log("Service Worker Registerd")}).catch(e=>{console.error(e)}),!1===navigator.onLine&&initMap()):!1===navigator.onLine&&initMapDetails()}),window.addEventListener("online",DBHelper.sendQueuedRequests,!1));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJhbGwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyplc2xpbnQgbm8tdW51c2VkLXZhcnM6IDAqL1xyXG4vKmVzbGludCBuby11bmRlZjogMCovXHJcbi8qZXNsaW50IG5vLWNvbnNvbGU6IDAqL1xyXG4vKmVzbGludCBsaW5lYnJlYWstc3R5bGU6IFtcImVycm9yXCIsIFwid2luZG93c1wiXSovXHJcbi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHQvKipcclxuXHQgKiBEYXRhYmFzZSBVUkwuXHJcblx0ICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG5cdFx0Y29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuXHRcdHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L2A7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0IFJFU1RBVVJBTlRfVVJMKCkge1xyXG5cdFx0cmV0dXJuIGAke3RoaXMuREFUQUJBU0VfVVJMfXJlc3RhdXJhbnRzL2A7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0IFJFVklFV19VUkwoKSB7XHJcblx0XHRyZXR1cm4gYCR7dGhpcy5EQVRBQkFTRV9VUkx9cmV2aWV3cy9gO1xyXG5cdH1cclxuXHJcblxyXG5cdHN0YXRpYyBnZXQgZGF0YWJhc2UoKSB7XHJcblx0XHQvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgc2VydmljZSB3b3JrZXIsXHJcblx0XHQvLyB3ZSBkb24ndCBjYXJlIGFib3V0IGhhdmluZyBhIGRhdGFiYXNlXHJcblx0XHRpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcblx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuXHRcdH1cclxuXHRcdGNvbnN0IGluZGV4ZWREQiA9IHdpbmRvdy5pbmRleGVkREIgfHwgd2luZG93Lm1vekluZGV4ZWREQiB8fCB3aW5kb3cud2Via2l0SW5kZXhlZERCIHx8IHdpbmRvdy5tc0luZGV4ZWREQiB8fCB3aW5kb3cuc2hpbUluZGV4ZWREQjtcclxuXHRcdHJldHVybiBpbmRleGVkREIub3BlbigncnJldmlld3MnLCAxKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuXHQgKi9cclxuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG5cdFx0ZmV0Y2goREJIZWxwZXIuUkVTVEFVUkFOVF9VUkwpXHJcblx0XHRcdC50aGVuKHJlc3BvbnNlID0+IHtcclxuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG5cdFx0XHR9KVxyXG5cdFx0XHQudGhlbihkYXRhID0+IHtcclxuXHRcdFx0XHQvL0dvdCB0aGUgZGF0YSwgbm93IHdyaXR0aW5nIGl0IGluIHRoZSBkYXRhYmFzZS5cclxuXHRcdFx0XHREQkhlbHBlci5zdG9yZVJlc3RhdXJhbnREYXRhSW5JbmRleGVkREIoZGF0YSk7XHJcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgZGF0YSk7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5jYXRjaChlcnJvciA9PiB7XHJcblx0XHRcdFx0REJIZWxwZXIuZ2V0UmVzdGF1cmFudERhdGFGcm9tSW5kZXhlZERCKCkudGhlbihkYXRhID0+IHtcclxuXHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIGRhdGEpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG5cdFx0Y29uc3QgcmV2aWV3VVJMID0gYCR7dGhpcy5SRVZJRVdfVVJMfT9yZXN0YXVyYW50X2lkPSR7aWR9YDtcclxuXHRcdGNvbnN0IERCT3BlblJlcXVlc3QgPSBEQkhlbHBlci5kYXRhYmFzZTtcclxuXHRcdERCSGVscGVyLnVwZ2FkZUluZGV4ZWREQihEQk9wZW5SZXF1ZXN0KTtcclxuXHRcdGlmIChEQk9wZW5SZXF1ZXN0KSB7XHJcblx0XHRcdERCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7XHJcblx0XHRcdFx0Y29uc3QgZGIgPSBEQk9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuXHRcdFx0XHRjb25zdCBzdG9yZSA9IGRiLnRyYW5zYWN0aW9uKFsncnJldmlld3MnXSwgJ3JlYWR3cml0ZScpLm9iamVjdFN0b3JlKCdycmV2aWV3cycpO1xyXG5cdFx0XHRcdGNvbnN0IGluZGV4ID0gc3RvcmUuaW5kZXgoJ2lkJyk7XHJcblxyXG5cdFx0XHRcdGluZGV4Lm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSAoZXZlbnQpID0+IHtcclxuXHRcdFx0XHRcdGNvbnN0IGN1cnNvciA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XHJcblx0XHRcdFx0XHRpZiAoY3Vyc29yKSB7XHJcblx0XHRcdFx0XHRcdGlmIChjdXJzb3IudmFsdWUuaWQgPT0gaWQpIHtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCByZXN0YXVyYW50ID0gY3Vyc29yLnZhbHVlO1xyXG5cdFx0XHRcdFx0XHRcdGZldGNoKHJldmlld1VSTClcclxuXHRcdFx0XHRcdFx0XHRcdC50aGVuKHJlc3BvbnNlID0+IHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuXHRcdFx0XHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHRcdFx0XHQudGhlbihkYXRhID0+IHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Ly9Hb3QgdGhlIGRhdGEsIG5vdyB3cml0dGluZyBpdCBpbiB0aGUgZGF0YWJhc2UuXHJcblx0XHRcdFx0XHRcdFx0XHRcdHJlc3RhdXJhbnQucmV2aWV3cyA9IGRhdGE7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGRiLnRyYW5zYWN0aW9uKFsncnJldmlld3MnXSwgJ3JlYWR3cml0ZScpLm9iamVjdFN0b3JlKCdycmV2aWV3cycpLnB1dChyZXN0YXVyYW50KTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcblx0XHRcdFx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0XHRcdFx0LmNhdGNoKGVycm9yID0+IHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcblx0XHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRjdXJzb3IuY29udGludWUoKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH07XHJcblxyXG5cdFx0XHR9O1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0c3RhdGljIHN0b3JlUmVzdGF1cmFudERhdGFJbkluZGV4ZWREQihkYXRhKSB7XHJcblx0XHQvL0dvdCB0aGUgZGF0YSwgbm93IHdyaXR0aW5nIGl0IGluIHRoZSBkYXRhYmFzZS5cclxuXHRcdGNvbnN0IERCT3BlblJlcXVlc3QgPSBEQkhlbHBlci5kYXRhYmFzZTtcclxuXHRcdERCSGVscGVyLnVwZ2FkZUluZGV4ZWREQihEQk9wZW5SZXF1ZXN0KTtcclxuXHRcdGlmIChEQk9wZW5SZXF1ZXN0KSB7XHJcblx0XHRcdERCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gZXZlbnQgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IGRiID0gREJPcGVuUmVxdWVzdC5yZXN1bHQ7XHJcblx0XHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncnJldmlld3MnLCAncmVhZHdyaXRlJyk7XHJcblx0XHRcdFx0Y29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncnJldmlld3MnKTtcclxuXHRcdFx0XHRkYXRhLmZvckVhY2goKHJlc3RhdXJhbnQpID0+IHtcclxuXHRcdFx0XHRcdHN0b3JlLnB1dChyZXN0YXVyYW50KTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHN0YXRpYyBzZXRSZXN0YXVyYW50RmF2b3JpdGUoaWQsIHN0YXRlKSB7XHJcblx0XHQvL0dvdCB0aGUgZGF0YSwgbm93IHdyaXR0aW5nIGl0IGluIHRoZSBkYXRhYmFzZS5cclxuXHRcdC8vV2UgY291bGQgaGF2ZSBqdXN0IHVzZWQgcmVzcG9uc2UgZnJvbSBQVVRcclxuXHRcdC8vbWV0aG9kLCBidXQgaW4gY2FzZSB3ZSdyZSBvZmZsaW5lIGxldCdzIHVwZGF0ZSB0aGUgZGIgZmlyc3RcclxuXHRcdGNvbnN0IERCT3BlblJlcXVlc3QgPSBEQkhlbHBlci5kYXRhYmFzZTtcclxuXHRcdERCSGVscGVyLnVwZ2FkZUluZGV4ZWREQihEQk9wZW5SZXF1ZXN0KTtcclxuXHRcdGlmIChEQk9wZW5SZXF1ZXN0KSB7XHJcblx0XHRcdERCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7XHJcblx0XHRcdFx0Y29uc3QgZGIgPSBEQk9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuXHRcdFx0XHRjb25zdCBpbmRleCA9IGRiLnRyYW5zYWN0aW9uKFsncnJldmlld3MnXSwgJ3JlYWR3cml0ZScpLm9iamVjdFN0b3JlKCdycmV2aWV3cycpLmluZGV4KCdpZCcpO1xyXG5cdFx0XHRcdGNvbnN0IHVybCA9IGAke3RoaXMuUkVTVEFVUkFOVF9VUkx9JHtpZH0vP2lzX2Zhdm9yaXRlPSR7c3RhdGV9YDtcclxuXHRcdFx0XHRpbmRleC5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7XHJcblx0XHRcdFx0XHRjb25zdCBjdXJzb3IgPSBldmVudC50YXJnZXQucmVzdWx0O1xyXG5cdFx0XHRcdFx0aWYgKGN1cnNvcikge1xyXG5cdFx0XHRcdFx0XHRpZiAoY3Vyc29yLnZhbHVlLmlkID09IGlkKSB7XHJcblx0XHRcdFx0XHRcdFx0Y3Vyc29yLnZhbHVlLmlzX2Zhdm9yaXRlID0gc3RhdGU7XHJcblx0XHRcdFx0XHRcdFx0Y3Vyc29yLnVwZGF0ZShjdXJzb3IudmFsdWUpO1xyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IHJlcSA9IG5ldyBSZXF1ZXN0KHVybCwge1xyXG5cdFx0XHRcdFx0XHRcdFx0bWV0aG9kOiAnUFVUJ1xyXG5cdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdGZldGNoKHJlcSkuY2F0Y2goZSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dGhpcy5hZGRSZXF1ZXN0VG9RdWV1ZSh7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0J3VybCc6IHVybCxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQnb3B0aW9ucyc6IHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG1ldGhvZDogJ1BVVCdcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGN1cnNvci5jb250aW51ZSgpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fTtcclxuXHJcblx0XHRcdH07XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgYWRkUmVzdGF1cmFudFJldmlldyhkYXRhKSB7XHJcblx0XHRjb25zdCByZXEgPSBuZXcgUmVxdWVzdCh0aGlzLlJFVklFV19VUkwsIHtcclxuXHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXHJcblx0XHRcdG1ldGhvZDogJ1BPU1QnXHJcblx0XHR9KTtcclxuXHRcdGZldGNoKHJlcSkudGhlbihyZXNwb25zZSA9PiB7XHJcblx0XHRcdHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcblx0XHR9KS50aGVuKHJldmlldyA9PiB7XHJcblx0XHRcdC8vZG8gYSByZWZyZXNoXHJcblx0XHRcdHRoaXMuZmV0Y2hSZXN0YXVyYW50QnlJZChkYXRhLnJlc3RhdXJhbnRfaWQsIHt9KTtcclxuXHRcdH0pLmNhdGNoKGUgPT4ge1xyXG5cdFx0XHRpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcclxuXHRcdFx0XHR0aGlzLmFkZFJlcXVlc3RUb1F1ZXVlKHtcclxuXHRcdFx0XHRcdHVybDogdGhpcy5SRVZJRVdfVVJMLFxyXG5cdFx0XHRcdFx0b3B0aW9uczoge1xyXG5cdFx0XHRcdFx0XHRib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcclxuXHRcdFx0XHRcdFx0bWV0aG9kOiAnUE9TVCdcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLmZldGNoUmVzdGF1cmFudEJ5SWQoZGF0YS5yZXN0YXVyYW50X2lkLCAoZXJyLCByc3QpID0+IHtcclxuXHRcdFx0XHRyc3QucmV2aWV3cy5wdXNoKGRhdGEpO1xyXG5cdFx0XHRcdGNvbnN0IERCT3BlblJlcXVlc3QgPSBEQkhlbHBlci5kYXRhYmFzZTtcclxuXHRcdFx0XHREQkhlbHBlci51cGdhZGVJbmRleGVkREIoREJPcGVuUmVxdWVzdCk7XHJcblx0XHRcdFx0aWYgKERCT3BlblJlcXVlc3QpIHtcclxuXHRcdFx0XHRcdERCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7XHJcblx0XHRcdFx0XHRcdGNvbnN0IGRiID0gREJPcGVuUmVxdWVzdC5yZXN1bHQ7XHJcblx0XHRcdFx0XHRcdGRiLnRyYW5zYWN0aW9uKFsncnJldmlld3MnXSwgJ3JlYWR3cml0ZScpLm9iamVjdFN0b3JlKCdycmV2aWV3cycpLnB1dChyc3QpO1xyXG5cdFx0XHRcdFx0fTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0UmVzdGF1cmFudERhdGFGcm9tSW5kZXhlZERCKCkge1xyXG5cdFx0Ly9JdCBzZWVtcyBsaWtlIHdlJ3ZlIGdvdCBhbiBlcnJvciB3aGlsZSB0cnlpbmcgdG8gcmVhZCBmcm9tIHRoZSBzZXJ2ZXJcclxuXHRcdC8vU28gdHJ5aW5nIHRvIGdldCBkYXRhIGZyb20gdGhlIGluZGV4ZWREQiBub3dcclxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblx0XHRcdGNvbnN0IERCT3BlblJlcXVlc3QgPSBEQkhlbHBlci5kYXRhYmFzZTtcclxuXHRcdFx0REJIZWxwZXIudXBnYWRlSW5kZXhlZERCKERCT3BlblJlcXVlc3QpO1xyXG5cdFx0XHRpZiAoREJPcGVuUmVxdWVzdCkge1xyXG5cdFx0XHRcdERCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gZXZlbnQgPT4ge1xyXG5cdFx0XHRcdFx0Y29uc3QgZGIgPSBEQk9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuXHRcdFx0XHRcdGNvbnN0IHN0b3JlID0gZGIudHJhbnNhY3Rpb24oJ3JyZXZpZXdzJywgJ3JlYWRvbmx5Jykub2JqZWN0U3RvcmUoJ3JyZXZpZXdzJyk7XHJcblx0XHRcdFx0XHRjb25zdCBkYXRhID0gW107XHJcblx0XHRcdFx0XHRzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZXZlbnQgPT4ge1xyXG5cdFx0XHRcdFx0XHRjb25zdCBjdXJzb3IgPSBldmVudC50YXJnZXQucmVzdWx0O1xyXG5cdFx0XHRcdFx0XHRpZiAoY3Vyc29yKSB7XHJcblx0XHRcdFx0XHRcdFx0ZGF0YS5wdXNoKGN1cnNvci52YWx1ZSk7XHJcblx0XHRcdFx0XHRcdFx0Y3Vyc29yLmNvbnRpbnVlKCk7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fTtcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyB1cGdhZGVJbmRleGVkREIoREJPcGVuUmVxdWVzdCkge1xyXG5cdFx0REJPcGVuUmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdGNvbnN0IGRiID0gREJPcGVuUmVxdWVzdC5yZXN1bHQ7XHJcblx0XHRcdGNvbnN0IHN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3JyZXZpZXdzJywge1xyXG5cdFx0XHRcdGtleVBhdGg6ICdpZCdcclxuXHRcdFx0fSk7XHJcblx0XHRcdHN0b3JlLmNyZWF0ZUluZGV4KCduYW1lJywgJ25hbWUnKTtcclxuXHRcdFx0c3RvcmUuY3JlYXRlSW5kZXgoJ2lkJywgJ2lkJywge1xyXG5cdFx0XHRcdHVuaXF1ZTogdHJ1ZVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0ZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3JlcXVlc3RxdWV1ZScsIHtcclxuXHRcdFx0XHRhdXRvSW5jcmVtZW50OiB0cnVlXHJcblx0XHRcdH0pO1xyXG5cdFx0fTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuXHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG5cdFx0XHRpZiAoZXJyb3IpIHtcclxuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Ly8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuXHRcdFx0XHRjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcblx0ICovXHJcblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG5cdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcblx0XHRcdGlmIChlcnJvcikge1xyXG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHQvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG5cdFx0XHRcdGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcblx0ICovXHJcblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuXHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG5cdFx0XHRpZiAoZXJyb3IpIHtcclxuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0bGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuXHRcdFx0XHRpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcblx0ICovXHJcblx0c3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcblx0XHREQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuXHRcdFx0aWYgKGVycm9yKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG5cdFx0XHRcdGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XHJcblx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcblx0XHRcdFx0Y29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XHJcblx0XHRcdFx0Y2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcblx0XHQvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuXHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG5cdFx0XHRpZiAoZXJyb3IpIHtcclxuXHRcdFx0XHRjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Ly8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG5cdFx0XHRcdGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xyXG5cdFx0XHRcdC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuXHRcdFx0XHRjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKTtcclxuXHRcdFx0XHRjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuXHQgKi9cclxuXHRzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcblx0XHRyZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuXHQgKi9cclxuXHRzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuXHRcdHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGggPyByZXN0YXVyYW50LnBob3RvZ3JhcGggOiByZXN0YXVyYW50LmlkfWApO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG5cdCAqL1xyXG5cdHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG5cdFx0Y29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcblx0XHRcdHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuXHRcdFx0dGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuXHRcdFx0dXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG5cdFx0XHRtYXA6IG1hcCxcclxuXHRcdFx0YW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG5cdFx0fSk7XHJcblx0XHRyZXR1cm4gbWFya2VyO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGFkZFJlcXVlc3RUb1F1ZXVlKHJlcXVlc3QpIHtcclxuXHRcdGNvbnN0IERCT3BlblJlcXVlc3QgPSBEQkhlbHBlci5kYXRhYmFzZTtcclxuXHRcdERCSGVscGVyLnVwZ2FkZUluZGV4ZWREQihEQk9wZW5SZXF1ZXN0KTtcclxuXHRcdGlmIChEQk9wZW5SZXF1ZXN0KSB7XHJcblx0XHRcdERCT3BlblJlcXVlc3Qub25zdWNjZXNzID0gZXZlbnQgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IGRiID0gREJPcGVuUmVxdWVzdC5yZXN1bHQ7XHJcblx0XHRcdFx0ZGIudHJhbnNhY3Rpb24oJ3JlcXVlc3RxdWV1ZScsICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZSgncmVxdWVzdHF1ZXVlJykucHV0KHJlcXVlc3QpO1xyXG5cdFx0XHR9O1xyXG5cdFx0fVxyXG5cdH1cclxuXHRzdGF0aWMgc2VuZFF1ZXVlZFJlcXVlc3RzKCkge1xyXG5cdFx0Y29uc3QgREJPcGVuUmVxdWVzdCA9IERCSGVscGVyLmRhdGFiYXNlO1xyXG5cdFx0REJIZWxwZXIudXBnYWRlSW5kZXhlZERCKERCT3BlblJlcXVlc3QpO1xyXG5cdFx0aWYgKERCT3BlblJlcXVlc3QpIHtcclxuXHRcdFx0REJPcGVuUmVxdWVzdC5vbnN1Y2Nlc3MgPSBldmVudCA9PiB7XHJcblx0XHRcdFx0Y29uc3QgZGIgPSBEQk9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuXHRcdFx0XHRjb25zdCBzdG9yZSA9IGRiLnRyYW5zYWN0aW9uKCdyZXF1ZXN0cXVldWUnLCAncmVhZHdyaXRlJykub2JqZWN0U3RvcmUoJ3JlcXVlc3RxdWV1ZScpO1xyXG5cdFx0XHRcdHN0b3JlLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSBldmVudCA9PiB7XHJcblx0XHRcdFx0XHRjb25zdCBjdXJzb3IgPSBldmVudC50YXJnZXQucmVzdWx0O1xyXG5cdFx0XHRcdFx0aWYgKGN1cnNvcikge1xyXG5cdFx0XHRcdFx0XHRjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoY3Vyc29yLnZhbHVlLnVybCwgY3Vyc29yLnZhbHVlLm9wdGlvbnMpO1xyXG5cdFx0XHRcdFx0XHRmZXRjaChyZXF1ZXN0KTtcclxuXHRcdFx0XHRcdFx0Y3Vyc29yLmRlbGV0ZSgpO1xyXG5cdFx0XHRcdFx0XHRjdXJzb3IuY29udGludWUoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9O1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG4vKiEgbGF6eXNpemVzIC0gdjQuMC4zICovXG4hZnVuY3Rpb24oYSxiKXt2YXIgYz1iKGEsYS5kb2N1bWVudCk7YS5sYXp5U2l6ZXM9YyxcIm9iamVjdFwiPT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cyYmKG1vZHVsZS5leHBvcnRzPWMpfSh3aW5kb3csZnVuY3Rpb24oYSxiKXtcInVzZSBzdHJpY3RcIjtpZihiLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpe3ZhciBjLGQsZT1iLmRvY3VtZW50RWxlbWVudCxmPWEuRGF0ZSxnPWEuSFRNTFBpY3R1cmVFbGVtZW50LGg9XCJhZGRFdmVudExpc3RlbmVyXCIsaT1cImdldEF0dHJpYnV0ZVwiLGo9YVtoXSxrPWEuc2V0VGltZW91dCxsPWEucmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxrLG09YS5yZXF1ZXN0SWRsZUNhbGxiYWNrLG49L15waWN0dXJlJC9pLG89W1wibG9hZFwiLFwiZXJyb3JcIixcImxhenlpbmNsdWRlZFwiLFwiX2xhenlsb2FkZWRcIl0scD17fSxxPUFycmF5LnByb3RvdHlwZS5mb3JFYWNoLHI9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gcFtiXXx8KHBbYl09bmV3IFJlZ0V4cChcIihcXFxcc3xeKVwiK2IrXCIoXFxcXHN8JClcIikpLHBbYl0udGVzdChhW2ldKFwiY2xhc3NcIil8fFwiXCIpJiZwW2JdfSxzPWZ1bmN0aW9uKGEsYil7cihhLGIpfHxhLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsKGFbaV0oXCJjbGFzc1wiKXx8XCJcIikudHJpbSgpK1wiIFwiK2IpfSx0PWZ1bmN0aW9uKGEsYil7dmFyIGM7KGM9cihhLGIpKSYmYS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLChhW2ldKFwiY2xhc3NcIil8fFwiXCIpLnJlcGxhY2UoYyxcIiBcIikpfSx1PWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1jP2g6XCJyZW1vdmVFdmVudExpc3RlbmVyXCI7YyYmdShhLGIpLG8uZm9yRWFjaChmdW5jdGlvbihjKXthW2RdKGMsYil9KX0sdj1mdW5jdGlvbihhLGQsZSxmLGcpe3ZhciBoPWIuY3JlYXRlRXZlbnQoXCJDdXN0b21FdmVudFwiKTtyZXR1cm4gZXx8KGU9e30pLGUuaW5zdGFuY2U9YyxoLmluaXRDdXN0b21FdmVudChkLCFmLCFnLGUpLGEuZGlzcGF0Y2hFdmVudChoKSxofSx3PWZ1bmN0aW9uKGIsYyl7dmFyIGU7IWcmJihlPWEucGljdHVyZWZpbGx8fGQucGYpP2Uoe3JlZXZhbHVhdGU6ITAsZWxlbWVudHM6W2JdfSk6YyYmYy5zcmMmJihiLnNyYz1jLnNyYyl9LHg9ZnVuY3Rpb24oYSxiKXtyZXR1cm4oZ2V0Q29tcHV0ZWRTdHlsZShhLG51bGwpfHx7fSlbYl19LHk9ZnVuY3Rpb24oYSxiLGMpe2ZvcihjPWN8fGEub2Zmc2V0V2lkdGg7YzxkLm1pblNpemUmJmImJiFhLl9sYXp5c2l6ZXNXaWR0aDspYz1iLm9mZnNldFdpZHRoLGI9Yi5wYXJlbnROb2RlO3JldHVybiBjfSx6PWZ1bmN0aW9uKCl7dmFyIGEsYyxkPVtdLGU9W10sZj1kLGc9ZnVuY3Rpb24oKXt2YXIgYj1mO2ZvcihmPWQubGVuZ3RoP2U6ZCxhPSEwLGM9ITE7Yi5sZW5ndGg7KWIuc2hpZnQoKSgpO2E9ITF9LGg9ZnVuY3Rpb24oZCxlKXthJiYhZT9kLmFwcGx5KHRoaXMsYXJndW1lbnRzKTooZi5wdXNoKGQpLGN8fChjPSEwLChiLmhpZGRlbj9rOmwpKGcpKSl9O3JldHVybiBoLl9sc0ZsdXNoPWcsaH0oKSxBPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGI/ZnVuY3Rpb24oKXt6KGEpfTpmdW5jdGlvbigpe3ZhciBiPXRoaXMsYz1hcmd1bWVudHM7eihmdW5jdGlvbigpe2EuYXBwbHkoYixjKX0pfX0sQj1mdW5jdGlvbihhKXt2YXIgYixjPTAsZT1kLnRocm90dGxlRGVsYXksZz1kLnJpY1RpbWVvdXQsaD1mdW5jdGlvbigpe2I9ITEsYz1mLm5vdygpLGEoKX0saT1tJiZnPjQ5P2Z1bmN0aW9uKCl7bShoLHt0aW1lb3V0Omd9KSxnIT09ZC5yaWNUaW1lb3V0JiYoZz1kLnJpY1RpbWVvdXQpfTpBKGZ1bmN0aW9uKCl7ayhoKX0sITApO3JldHVybiBmdW5jdGlvbihhKXt2YXIgZDsoYT1hPT09ITApJiYoZz0zMyksYnx8KGI9ITAsZD1lLShmLm5vdygpLWMpLDA+ZCYmKGQ9MCksYXx8OT5kP2koKTprKGksZCkpfX0sQz1mdW5jdGlvbihhKXt2YXIgYixjLGQ9OTksZT1mdW5jdGlvbigpe2I9bnVsbCxhKCl9LGc9ZnVuY3Rpb24oKXt2YXIgYT1mLm5vdygpLWM7ZD5hP2soZyxkLWEpOihtfHxlKShlKX07cmV0dXJuIGZ1bmN0aW9uKCl7Yz1mLm5vdygpLGJ8fChiPWsoZyxkKSl9fTshZnVuY3Rpb24oKXt2YXIgYixjPXtsYXp5Q2xhc3M6XCJsYXp5bG9hZFwiLGxvYWRlZENsYXNzOlwibGF6eWxvYWRlZFwiLGxvYWRpbmdDbGFzczpcImxhenlsb2FkaW5nXCIscHJlbG9hZENsYXNzOlwibGF6eXByZWxvYWRcIixlcnJvckNsYXNzOlwibGF6eWVycm9yXCIsYXV0b3NpemVzQ2xhc3M6XCJsYXp5YXV0b3NpemVzXCIsc3JjQXR0cjpcImRhdGEtc3JjXCIsc3Jjc2V0QXR0cjpcImRhdGEtc3Jjc2V0XCIsc2l6ZXNBdHRyOlwiZGF0YS1zaXplc1wiLG1pblNpemU6NDAsY3VzdG9tTWVkaWE6e30saW5pdDohMCxleHBGYWN0b3I6MS41LGhGYWM6LjgsbG9hZE1vZGU6Mixsb2FkSGlkZGVuOiEwLHJpY1RpbWVvdXQ6MCx0aHJvdHRsZURlbGF5OjEyNX07ZD1hLmxhenlTaXplc0NvbmZpZ3x8YS5sYXp5c2l6ZXNDb25maWd8fHt9O2ZvcihiIGluIGMpYiBpbiBkfHwoZFtiXT1jW2JdKTthLmxhenlTaXplc0NvbmZpZz1kLGsoZnVuY3Rpb24oKXtkLmluaXQmJkYoKX0pfSgpO3ZhciBEPWZ1bmN0aW9uKCl7dmFyIGcsbCxtLG8scCx5LEQsRixHLEgsSSxKLEssTCxNPS9eaW1nJC9pLE49L15pZnJhbWUkL2ksTz1cIm9uc2Nyb2xsXCJpbiBhJiYhL2dsZWJvdC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSxQPTAsUT0wLFI9MCxTPS0xLFQ9ZnVuY3Rpb24oYSl7Ui0tLGEmJmEudGFyZ2V0JiZ1KGEudGFyZ2V0LFQpLCghYXx8MD5SfHwhYS50YXJnZXQpJiYoUj0wKX0sVT1mdW5jdGlvbihhLGMpe3ZhciBkLGY9YSxnPVwiaGlkZGVuXCI9PXgoYi5ib2R5LFwidmlzaWJpbGl0eVwiKXx8XCJoaWRkZW5cIiE9eChhLFwidmlzaWJpbGl0eVwiKTtmb3IoRi09YyxJKz1jLEctPWMsSCs9YztnJiYoZj1mLm9mZnNldFBhcmVudCkmJmYhPWIuYm9keSYmZiE9ZTspZz0oeChmLFwib3BhY2l0eVwiKXx8MSk+MCxnJiZcInZpc2libGVcIiE9eChmLFwib3ZlcmZsb3dcIikmJihkPWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksZz1IPmQubGVmdCYmRzxkLnJpZ2h0JiZJPmQudG9wLTEmJkY8ZC5ib3R0b20rMSk7cmV0dXJuIGd9LFY9ZnVuY3Rpb24oKXt2YXIgYSxmLGgsaixrLG0sbixwLHEscj1jLmVsZW1lbnRzO2lmKChvPWQubG9hZE1vZGUpJiY4PlImJihhPXIubGVuZ3RoKSl7Zj0wLFMrKyxudWxsPT1LJiYoXCJleHBhbmRcImluIGR8fChkLmV4cGFuZD1lLmNsaWVudEhlaWdodD41MDAmJmUuY2xpZW50V2lkdGg+NTAwPzUwMDozNzApLEo9ZC5leHBhbmQsSz1KKmQuZXhwRmFjdG9yKSxLPlEmJjE+UiYmUz4yJiZvPjImJiFiLmhpZGRlbj8oUT1LLFM9MCk6UT1vPjEmJlM+MSYmNj5SP0o6UDtmb3IoO2E+ZjtmKyspaWYocltmXSYmIXJbZl0uX2xhenlSYWNlKWlmKE8paWYoKHA9cltmXVtpXShcImRhdGEtZXhwYW5kXCIpKSYmKG09MSpwKXx8KG09USkscSE9PW0mJih5PWlubmVyV2lkdGgrbSpMLEQ9aW5uZXJIZWlnaHQrbSxuPS0xKm0scT1tKSxoPXJbZl0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksKEk9aC5ib3R0b20pPj1uJiYoRj1oLnRvcCk8PUQmJihIPWgucmlnaHQpPj1uKkwmJihHPWgubGVmdCk8PXkmJihJfHxIfHxHfHxGKSYmKGQubG9hZEhpZGRlbnx8XCJoaWRkZW5cIiE9eChyW2ZdLFwidmlzaWJpbGl0eVwiKSkmJihsJiYzPlImJiFwJiYoMz5vfHw0PlMpfHxVKHJbZl0sbSkpKXtpZihiYShyW2ZdKSxrPSEwLFI+OSlicmVha31lbHNlIWsmJmwmJiFqJiY0PlImJjQ+UyYmbz4yJiYoZ1swXXx8ZC5wcmVsb2FkQWZ0ZXJMb2FkKSYmKGdbMF18fCFwJiYoSXx8SHx8R3x8Rnx8XCJhdXRvXCIhPXJbZl1baV0oZC5zaXplc0F0dHIpKSkmJihqPWdbMF18fHJbZl0pO2Vsc2UgYmEocltmXSk7aiYmIWsmJmJhKGopfX0sVz1CKFYpLFg9ZnVuY3Rpb24oYSl7cyhhLnRhcmdldCxkLmxvYWRlZENsYXNzKSx0KGEudGFyZ2V0LGQubG9hZGluZ0NsYXNzKSx1KGEudGFyZ2V0LFopLHYoYS50YXJnZXQsXCJsYXp5bG9hZGVkXCIpfSxZPUEoWCksWj1mdW5jdGlvbihhKXtZKHt0YXJnZXQ6YS50YXJnZXR9KX0sJD1mdW5jdGlvbihhLGIpe3RyeXthLmNvbnRlbnRXaW5kb3cubG9jYXRpb24ucmVwbGFjZShiKX1jYXRjaChjKXthLnNyYz1ifX0sXz1mdW5jdGlvbihhKXt2YXIgYixjPWFbaV0oZC5zcmNzZXRBdHRyKTsoYj1kLmN1c3RvbU1lZGlhW2FbaV0oXCJkYXRhLW1lZGlhXCIpfHxhW2ldKFwibWVkaWFcIildKSYmYS5zZXRBdHRyaWJ1dGUoXCJtZWRpYVwiLGIpLGMmJmEuc2V0QXR0cmlidXRlKFwic3Jjc2V0XCIsYyl9LGFhPUEoZnVuY3Rpb24oYSxiLGMsZSxmKXt2YXIgZyxoLGosbCxvLHA7KG89dihhLFwibGF6eWJlZm9yZXVudmVpbFwiLGIpKS5kZWZhdWx0UHJldmVudGVkfHwoZSYmKGM/cyhhLGQuYXV0b3NpemVzQ2xhc3MpOmEuc2V0QXR0cmlidXRlKFwic2l6ZXNcIixlKSksaD1hW2ldKGQuc3Jjc2V0QXR0ciksZz1hW2ldKGQuc3JjQXR0ciksZiYmKGo9YS5wYXJlbnROb2RlLGw9aiYmbi50ZXN0KGoubm9kZU5hbWV8fFwiXCIpKSxwPWIuZmlyZXNMb2FkfHxcInNyY1wiaW4gYSYmKGh8fGd8fGwpLG89e3RhcmdldDphfSxwJiYodShhLFQsITApLGNsZWFyVGltZW91dChtKSxtPWsoVCwyNTAwKSxzKGEsZC5sb2FkaW5nQ2xhc3MpLHUoYSxaLCEwKSksbCYmcS5jYWxsKGouZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzb3VyY2VcIiksXyksaD9hLnNldEF0dHJpYnV0ZShcInNyY3NldFwiLGgpOmcmJiFsJiYoTi50ZXN0KGEubm9kZU5hbWUpPyQoYSxnKTphLnNyYz1nKSxmJiYoaHx8bCkmJncoYSx7c3JjOmd9KSksYS5fbGF6eVJhY2UmJmRlbGV0ZSBhLl9sYXp5UmFjZSx0KGEsZC5sYXp5Q2xhc3MpLHooZnVuY3Rpb24oKXsoIXB8fGEuY29tcGxldGUmJmEubmF0dXJhbFdpZHRoPjEpJiYocD9UKG8pOlItLSxYKG8pKX0sITApfSksYmE9ZnVuY3Rpb24oYSl7dmFyIGIsYz1NLnRlc3QoYS5ub2RlTmFtZSksZT1jJiYoYVtpXShkLnNpemVzQXR0cil8fGFbaV0oXCJzaXplc1wiKSksZj1cImF1dG9cIj09ZTsoIWYmJmx8fCFjfHwhYVtpXShcInNyY1wiKSYmIWEuc3Jjc2V0fHxhLmNvbXBsZXRlfHxyKGEsZC5lcnJvckNsYXNzKXx8IXIoYSxkLmxhenlDbGFzcykpJiYoYj12KGEsXCJsYXp5dW52ZWlscmVhZFwiKS5kZXRhaWwsZiYmRS51cGRhdGVFbGVtKGEsITAsYS5vZmZzZXRXaWR0aCksYS5fbGF6eVJhY2U9ITAsUisrLGFhKGEsYixmLGUsYykpfSxjYT1mdW5jdGlvbigpe2lmKCFsKXtpZihmLm5vdygpLXA8OTk5KXJldHVybiB2b2lkIGsoY2EsOTk5KTt2YXIgYT1DKGZ1bmN0aW9uKCl7ZC5sb2FkTW9kZT0zLFcoKX0pO2w9ITAsZC5sb2FkTW9kZT0zLFcoKSxqKFwic2Nyb2xsXCIsZnVuY3Rpb24oKXszPT1kLmxvYWRNb2RlJiYoZC5sb2FkTW9kZT0yKSxhKCl9LCEwKX19O3JldHVybntfOmZ1bmN0aW9uKCl7cD1mLm5vdygpLGMuZWxlbWVudHM9Yi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGQubGF6eUNsYXNzKSxnPWIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShkLmxhenlDbGFzcytcIiBcIitkLnByZWxvYWRDbGFzcyksTD1kLmhGYWMsaihcInNjcm9sbFwiLFcsITApLGooXCJyZXNpemVcIixXLCEwKSxhLk11dGF0aW9uT2JzZXJ2ZXI/bmV3IE11dGF0aW9uT2JzZXJ2ZXIoVykub2JzZXJ2ZShlLHtjaGlsZExpc3Q6ITAsc3VidHJlZTohMCxhdHRyaWJ1dGVzOiEwfSk6KGVbaF0oXCJET01Ob2RlSW5zZXJ0ZWRcIixXLCEwKSxlW2hdKFwiRE9NQXR0ck1vZGlmaWVkXCIsVywhMCksc2V0SW50ZXJ2YWwoVyw5OTkpKSxqKFwiaGFzaGNoYW5nZVwiLFcsITApLFtcImZvY3VzXCIsXCJtb3VzZW92ZXJcIixcImNsaWNrXCIsXCJsb2FkXCIsXCJ0cmFuc2l0aW9uZW5kXCIsXCJhbmltYXRpb25lbmRcIixcIndlYmtpdEFuaW1hdGlvbkVuZFwiXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe2JbaF0oYSxXLCEwKX0pLC9kJHxeYy8udGVzdChiLnJlYWR5U3RhdGUpP2NhKCk6KGooXCJsb2FkXCIsY2EpLGJbaF0oXCJET01Db250ZW50TG9hZGVkXCIsVyksayhjYSwyZTQpKSxjLmVsZW1lbnRzLmxlbmd0aD8oVigpLHouX2xzRmx1c2goKSk6VygpfSxjaGVja0VsZW1zOlcsdW52ZWlsOmJhfX0oKSxFPWZ1bmN0aW9uKCl7dmFyIGEsYz1BKGZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlLGYsZztpZihhLl9sYXp5c2l6ZXNXaWR0aD1kLGQrPVwicHhcIixhLnNldEF0dHJpYnV0ZShcInNpemVzXCIsZCksbi50ZXN0KGIubm9kZU5hbWV8fFwiXCIpKWZvcihlPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzb3VyY2VcIiksZj0wLGc9ZS5sZW5ndGg7Zz5mO2YrKyllW2ZdLnNldEF0dHJpYnV0ZShcInNpemVzXCIsZCk7Yy5kZXRhaWwuZGF0YUF0dHJ8fHcoYSxjLmRldGFpbCl9KSxlPWZ1bmN0aW9uKGEsYixkKXt2YXIgZSxmPWEucGFyZW50Tm9kZTtmJiYoZD15KGEsZixkKSxlPXYoYSxcImxhenliZWZvcmVzaXplc1wiLHt3aWR0aDpkLGRhdGFBdHRyOiEhYn0pLGUuZGVmYXVsdFByZXZlbnRlZHx8KGQ9ZS5kZXRhaWwud2lkdGgsZCYmZCE9PWEuX2xhenlzaXplc1dpZHRoJiZjKGEsZixlLGQpKSl9LGY9ZnVuY3Rpb24oKXt2YXIgYixjPWEubGVuZ3RoO2lmKGMpZm9yKGI9MDtjPmI7YisrKWUoYVtiXSl9LGc9QyhmKTtyZXR1cm57XzpmdW5jdGlvbigpe2E9Yi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGQuYXV0b3NpemVzQ2xhc3MpLGooXCJyZXNpemVcIixnKX0sY2hlY2tFbGVtczpnLHVwZGF0ZUVsZW06ZX19KCksRj1mdW5jdGlvbigpe0YuaXx8KEYuaT0hMCxFLl8oKSxELl8oKSl9O3JldHVybiBjPXtjZmc6ZCxhdXRvU2l6ZXI6RSxsb2FkZXI6RCxpbml0OkYsdVA6dyxhQzpzLHJDOnQsaEM6cixmaXJlOnYsZ1c6eSxyQUY6en19fSk7XHJcbi8qZXNsaW50IG5vLWNvbnNvbGU6IDAqL1xyXG4vKmVzbGludCBuby11bnVzZWQtdmFyczogMCovXHJcbi8qZXNsaW50IG5vLXVuZGVmOiAwKi9cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG5cdGZldGNoTmVpZ2hib3Job29kcygpO1xyXG5cdGZldGNoQ3Vpc2luZXMoKTtcclxufSk7XHJcblxyXG5sZXQgbWFwO1xyXG5cclxuLypjb25zdCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihvbkludGVyc2VjdGlvbiwge1xyXG5cdHJvb3RNYXJnaW46ICcwcHgnLFxyXG5cdHRocmVzaG9sZDogMC4xXHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gb25JbnRlcnNlY3Rpb24oZW50cmllcykge1xyXG5cdC8vIExvb3AgdGhyb3VnaCB0aGUgZW50cmllc1xyXG5cdGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7XHJcblx0XHQvLyBBcmUgd2UgaW4gdmlld3BvcnQ/XHJcblx0XHRpZiAoZW50cnkuaW50ZXJzZWN0aW9uUmF0aW8gPiAwKSB7XHJcblxyXG5cdFx0XHQvLyBTdG9wIHdhdGNoaW5nIGFuZCBsb2FkIHRoZSBpbWFnZVxyXG5cdFx0XHRvYnNlcnZlci51bm9ic2VydmUoZW50cnkudGFyZ2V0KTtcclxuXHRcdFx0bG9hZEltYWdlKGVudHJ5LnRhcmdldCk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxvYWRJbWFnZShpbWFnZSkge1xyXG5cdGNvbnN0IHNyYyA9IGltYWdlLmRhdGFzZXQuc3JjO1xyXG5cdGZldGNoSW1hZ2Uoc3JjKS50aGVuKCgpID0+IHtcclxuXHRcdGltYWdlLnNyYyA9IHNyYztcclxuXHR9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZmV0Y2hJbWFnZSh1cmwpIHtcclxuXHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cdFx0Y29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuXHRcdGltYWdlLnNyYyA9IHVybDtcclxuXHRcdGltYWdlLm9ubG9hZCA9IHJlc29sdmU7XHJcblx0XHRpbWFnZS5vbmVycm9yID0gcmVqZWN0O1xyXG5cdH0pO1xyXG59XHJcblxyXG4qL1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZldGNoTmVpZ2hib3Job29kcygpIHtcclxuXHREQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XHJcblx0XHRpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yXHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcclxuXHRcdFx0ZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxyXG4gKi9cclxuZnVuY3Rpb24gZmlsbE5laWdoYm9yaG9vZHNIVE1MKG5laWdoYm9yaG9vZHMgPSB0aGlzLm5laWdoYm9yaG9vZHMpIHtcclxuXHRjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHRpZiAoc2VsZWN0KSB7XHJcblx0XHRuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcclxuXHRcdFx0Y29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcblx0XHRcdG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcblx0XHRcdG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuXHRcdFx0c2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XHJcblx0XHR9KTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZnVuY3Rpb24gZmV0Y2hDdWlzaW5lcygpIHtcclxuXHREQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcclxuXHRcdGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5jdWlzaW5lcyA9IGN1aXNpbmVzO1xyXG5cdFx0XHRmaWxsQ3Vpc2luZXNIVE1MKCk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxDdWlzaW5lc0hUTUwoY3Vpc2luZXMgPSB0aGlzLmN1aXNpbmVzKSB7XHJcblx0Y29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cdGlmIChzZWxlY3QpIHtcclxuXHRcdGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcblx0XHRcdGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG5cdFx0XHRvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuXHRcdFx0b3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuXHRcdFx0c2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XHJcblx0XHR9KTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuXHRsZXQgbG9jID0ge1xyXG5cdFx0bGF0OiA0MC43MjIyMTYsXHJcblx0XHRsbmc6IC03My45ODc1MDFcclxuXHR9O1xyXG5cdGlmKHR5cGVvZiAoZ29vZ2xlKSAhPT0gJ3VuZGVmaW5lZCcpe1xyXG5cdFx0dGhpcy5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG5cdFx0XHR6b29tOiAxMixcclxuXHRcdFx0Y2VudGVyOiBsb2MsXHJcblx0XHRcdHNjcm9sbHdoZWVsOiBmYWxzZVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cdHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbmZ1bmN0aW9uIHVwZGF0ZVJlc3RhdXJhbnRzKCkge1xyXG5cdGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcblx0Y29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG5cclxuXHRjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblx0Y29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cclxuXHRjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xyXG5cdGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcclxuXHJcblx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG5cdFx0aWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcik7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRyZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuXHRcdFx0ZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59XHJcblxyXG4vKipcclxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxyXG4gKi9cclxuZnVuY3Rpb24gcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cykge1xyXG5cdC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuXHR0aGlzLnJlc3RhdXJhbnRzID0gW107XHJcblx0Y29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG5cdHVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuXHQvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcblx0aWYgKHRoaXMubWFya2Vycykge1xyXG5cdFx0dGhpcy5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcblx0fVxyXG5cdHRoaXMubWFya2VycyA9IFtdO1xyXG5cdHRoaXMucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufVxyXG4vKlxyXG5mdW5jdGlvbiBzdGFydE9ic2VydmVyKCkge1xyXG5cdGNvbnN0IGltYWdlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZXN0YXVyYW50LWltZycpO1xyXG5cdGltYWdlcy5mb3JFYWNoKGltYWdlID0+IHtcclxuXHRcdG9ic2VydmVyLm9ic2VydmUoaW1hZ2UpO1xyXG5cdH0pO1xyXG59Ki9cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRzSFRNTChyZXN0YXVyYW50cyA9IHRoaXMucmVzdGF1cmFudHMpIHtcclxuXHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcblx0cmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuXHRcdHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuXHR9KTtcclxuXHQvL3N0YXJ0T2JzZXJ2ZXIoKTtcclxuXHRpZiAodHlwZW9mIGdvb2dsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuXHRcdGFkZE1hcmtlcnNUb01hcCgpO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSB7XHJcblx0aWYgKHR5cGVvZiByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAndW5kZWZpbmVkJykge1xyXG5cdFx0cmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGZhbHNlO1xyXG5cdH1cclxuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblx0bGkuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtY2FyZCc7XHJcblxyXG5cdGNvbnN0IHBpY3R1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwaWN0dXJlJyk7IC8vSGVyZSBnb2VzIHRoZSBuZXcgcGljdHVyZSB0YWcsIHRoYXQgd2lsbCBpbmNsdWRlIHRoZSA8aW1nPlxyXG5cdHBpY3R1cmUuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtcGljdHVyZSc7IC8vdGhhdCBpcyBob3cgd2Ugd2lsbCBzZXJ2ZSBkaWZlcmVudCBzaXplcyBvZiBpbWFnZXNcclxuXHJcblx0Ly9uZXh0IGJsb2NrIHByZXBhcmVzIHNvdXJjZSB0YWcgZm9yIHNtYWxsIGltYWdlc1xyXG5cdGNvbnN0IHNyY1NtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcblx0c3JjU21hbGwuY2xhc3NOYW1lID0gJ2xhenlsb2FkIHNvdXJjZS1zbWFsbCc7XHJcblx0bGV0IHBpY1VybFNtYWxsID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLmNvbmNhdCgnLXNtYWxsLmpwZycpO1xyXG5cdGxldCBwaWNVcmxNZWRpdW0gPSBwaWNVcmxTbWFsbC5yZXBsYWNlKCdzbWFsbCcsICdtZWRpdW0nKTtcclxuXHQvL3NyY1NtYWxsLnNyY3NldCA9IHBpY1VybFNtYWxsICsgJyAxeCwgJyArIHBpY1VybE1lZGl1bSArICcgMngnO1xyXG5cdHNyY1NtYWxsLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmNzZXQnLHBpY1VybFNtYWxsICsgJyAxeCwgJyArIHBpY1VybE1lZGl1bSArICcgMngnKTtcclxuXHRwaWN0dXJlLmFwcGVuZENoaWxkKHNyY1NtYWxsKTtcclxuXHJcblx0Ly9uZXh0IGJsb2NrIHByZXBhcmVzIHNvdXJjZSB0YWcgZm9yIGxhcmdlIGltYWdlc1xyXG5cdGNvbnN0IHNyY0xhcmdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcblx0c3JjTGFyZ2UuY2xhc3NOYW1lID0gJ2xhenlsb2FkIHNvdXJjZS1sYXJnZSc7XHJcblx0bGV0IHBpY1VybExhcmdlID0gcGljVXJsU21hbGwucmVwbGFjZSgnc21hbGwnLCAnbGFyZ2UnKTtcclxuXHQvL3NyY0xhcmdlLnNyY3NldCA9IHBpY1VybE1lZGl1bSArICcgMXgsICcgKyBwaWNVcmxMYXJnZSArICcgMngnO1xyXG5cdHNyY0xhcmdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmNzZXQnLCBwaWNVcmxNZWRpdW0gKyAnIDF4LCAnICsgcGljVXJsTGFyZ2UgKyAnIDJ4Jyk7XHJcblx0c3JjTGFyZ2UubWVkaWEgPSAnKG1pbi13aWR0aDogNzUwcHgpJztcclxuXHRwaWN0dXJlLmFwcGVuZENoaWxkKHNyY0xhcmdlKTtcclxuXHJcblx0Ly9jcmVhdGluZyBpbWcgdGFnLCBhbmQgYWRkaW5nIGFsdFxyXG5cdGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcblx0aW1hZ2UuY2xhc3NOYW1lID0gJ2xhenlsb2FkIHJlc3RhdXJhbnQtaW1nJztcclxuXHRpbWFnZS5hbHQgPSAnSW1hZ2Ugb2YgXCInICsgcmVzdGF1cmFudC5uYW1lICsgJ1wiIHJlc3RhdXJhbnQuJztcclxuXHQvL2ltYWdlLnNyYyA9IHBpY1VybFNtYWxsO1xyXG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmMnLCBwaWNVcmxTbWFsbCk7XHJcblx0cGljdHVyZS5hcHBlbmRDaGlsZChpbWFnZSk7XHJcblxyXG5cdGNvbnN0IGluZm9Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRpbmZvQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWluZm8tY29udGFpbmVyJztcclxuXHRpbmZvQ29udGFpbmVyLmFwcGVuZENoaWxkKHBpY3R1cmUpO1xyXG5cclxuXHRcclxuXHRjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuXHRuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuXHRpbmZvQ29udGFpbmVyLmFwcGVuZENoaWxkKG5hbWUpO1xyXG5cdFxyXG5cdGNvbnN0IGZhdm9yaXRlX2ljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcblx0Y29uc3QgZmF2X2ljb25fYXJpYV9sYWJlbCA9IEpTT04ucGFyc2UocmVzdGF1cmFudC5pc19mYXZvcml0ZSkgPyAnUmVtb3ZlIHJlc3RhdXJhbnQgJyArIHJlc3RhdXJhbnQubmFtZSArICdmcm9tIGZhdm9yaXRlcy4nIDogJ0FkZCByZXN0YXVyYW50ICcgKyByZXN0YXVyYW50Lm5hbWUgKyAndG8gZmF2b3JpdGVzLic7XHJcblx0ZmF2b3JpdGVfaWNvbi5jbGFzc05hbWUgPSAndGFwLXRhcmdldCB0b3AtcmlnaHQnO1xyXG5cdGZhdm9yaXRlX2ljb24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgZmF2X2ljb25fYXJpYV9sYWJlbCk7XHJcblx0ZmF2b3JpdGVfaWNvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XHJcblx0ZmF2b3JpdGVfaWNvbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcclxuXHRmYXZvcml0ZV9pY29uLnNldEF0dHJpYnV0ZSgnZGF0YS1yZXN0aWQnLCByZXN0YXVyYW50LmlkKTtcclxuXHRmYXZvcml0ZV9pY29uLnNldEF0dHJpYnV0ZSgnaXMtZmF2b3JpdGUnLCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlKTtcclxuXHRmYXZvcml0ZV9pY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlRmF2b3JpdGUsIGZhbHNlKTtcclxuXHRpbmZvQ29udGFpbmVyLmFwcGVuZENoaWxkKGZhdm9yaXRlX2ljb24pO1xyXG5cclxuXHRjb25zdCBmYXZvcml0ZV9zeW1ib2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7XHJcblx0ZmF2b3JpdGVfc3ltYm9sLmNsYXNzTmFtZSA9ICdtYXRlcmlhbC1pY29ucyBmYXZvcml0ZS1pY29uJztcclxuXHRmYXZvcml0ZV9zeW1ib2wuaW5uZXJIVE1MID0gSlNPTi5wYXJzZShyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKSA/ICdmYXZvcml0ZScgOidmYXZvcml0ZV9ib3JkZXInO1xyXG5cdGZhdm9yaXRlX2ljb24uYXBwZW5kQ2hpbGQoZmF2b3JpdGVfc3ltYm9sKTtcclxuXHRcclxuXHRjb25zdCBhZGRyZXNzQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0YWRkcmVzc0NvbnRhaW5lci5jbGFzc05hbWUgPSAnYWRkcmVzcy1jb250YWluZXInO1xyXG5cclxuXHRjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcblx0bmVpZ2hib3Job29kLnNldEF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScsICdyZXN0YXVyYW50LW5laWdoYm9yaG9vZC1sYWJlbCcpO1xyXG5cdG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuXHRhZGRyZXNzQ29udGFpbmVyLmFwcGVuZENoaWxkKG5laWdoYm9yaG9vZCk7XHJcblxyXG5cdGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcblx0YWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcblx0YWRkcmVzcy5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknLCAncmVzdGF1cmFudC1hZGRyZXNzLWxhYmVsJyk7XHJcblx0YWRkcmVzc0NvbnRhaW5lci5hcHBlbmRDaGlsZChhZGRyZXNzKTtcclxuXHJcblx0aW5mb0NvbnRhaW5lci5hcHBlbmRDaGlsZChhZGRyZXNzQ29udGFpbmVyKTtcclxuXHJcblx0bGkuYXBwZW5kQ2hpbGQoaW5mb0NvbnRhaW5lcik7XHJcblxyXG5cdGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcblx0bW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuXHRtb3JlLmNsYXNzTmFtZSA9ICd0YXAtdGFyZ2V0IHJlc3RhdXJhbnQtY2FyZC1kZXRhaWxzJztcclxuXHRtb3JlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdSZXN0YXVyYW50OiAnICsgcmVzdGF1cmFudC5uYW1lICsgJzogdmlldyBkZXRhaWxzLicpO1xyXG5cdG1vcmUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpO1xyXG5cdG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcblx0bGkuYXBwZW5kQ2hpbGQobW9yZSk7XHJcblxyXG5cdHJldHVybiBsaTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5mdW5jdGlvbiBhZGRNYXJrZXJzVG9NYXAocmVzdGF1cmFudHMgPSB0aGlzLnJlc3RhdXJhbnRzKSB7XHJcblx0cmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuXHRcdC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG5cdFx0Y29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB0aGlzLm1hcCk7XHJcblx0XHRnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xyXG5cdFx0fSk7XHJcblx0XHR0aGlzLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG5cdH0pO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlRmF2b3JpdGUoZSkge1xyXG5cdGlmICghZSlcclxuXHRcdGUgPSB3aW5kb3cuZXZlbnQ7XHJcblx0Y29uc3Qgc2VuZGVyID0gZS5zcmNFbGVtZW50IHx8IGUudGFyZ2V0O1xyXG5cdGNvbnN0IGlkID0gdGhpcy5kYXRhc2V0LnJlc3RpZDtcclxuXHQvL0ludmVydGluZyB2YWx1ZSBpbiB0ZSBuZXh0IGxpbmVcclxuXHRsZXQgc3RhdGUgPSBKU09OLnBhcnNlKHRoaXMuZ2V0QXR0cmlidXRlKCdpcy1mYXZvcml0ZScpKSA/IGZhbHNlIDogdHJ1ZTtcclxuXHRcclxuXHRpZihpZCl7XHJcblx0XHR0aGlzLnNldEF0dHJpYnV0ZSgnaXMtZmF2b3JpdGUnLHN0YXRlKTtcclxuXHRcdERCSGVscGVyLnNldFJlc3RhdXJhbnRGYXZvcml0ZShpZCwgc3RhdGUpO1xyXG5cdFx0aWYoc2VuZGVyID09IHRoaXMpe1xyXG5cdFx0XHRpZih0aGlzLmNoaWxkTm9kZXMubGVuZ3RoID4gMCl7XHJcblx0XHRcdFx0dGhpcy5jaGlsZE5vZGVzWzBdLmlubmVySFRNTCA9IHN0YXRlID8gJ2Zhdm9yaXRlJyA6J2Zhdm9yaXRlX2JvcmRlcic7XHJcblx0XHRcdH1cclxuXHRcdH1lbHNle1xyXG5cdFx0XHRzZW5kZXIuaW5uZXJIVE1MID0gc3RhdGUgPyAnZmF2b3JpdGUnIDonZmF2b3JpdGVfYm9yZGVyJztcclxuXHJcblx0XHR9XHJcblx0fVxyXG59XHJcbi8qZXNsaW50IG5vLWNvbnNvbGU6IDAqL1xyXG4vKmVzbGludCBuby11bnVzZWQtdmFyczogMCovXHJcbi8qZXNsaW50IG5vLXVuZGVmOiAwKi9cclxuXHJcbmxldCByZXN0YXVyYW50O1xyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwRGV0YWlscyA9ICgpID0+IHtcclxuXHRmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xyXG5cdFx0aWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcik7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRpZih0eXBlb2YgZ29vZ2xlICE9PSAndW5kZWZpbmVkJyl7XHJcblx0XHRcdFx0c2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG5cdFx0XHRcdFx0em9vbTogMTYsXHJcblx0XHRcdFx0XHRjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxyXG5cdFx0XHRcdFx0c2Nyb2xsd2hlZWw6IGZhbHNlXHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0REJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRmaWxsQnJlYWRjcnVtYigpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEZyb21VUkwoY2FsbGJhY2spe1xyXG5cdGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcblx0XHRjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xyXG5cdFx0cmV0dXJuO1xyXG5cdH1cclxuXHRjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcclxuXHRpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxyXG5cdFx0Y2FsbGJhY2soJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJywgbnVsbCk7XHJcblx0fSBlbHNlIHtcclxuXHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xyXG5cdFx0XHRzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xyXG5cdFx0XHRpZiAoIXJlc3RhdXJhbnQpIHtcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0ZmlsbFJlc3RhdXJhbnRIVE1MKCk7XHJcblx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCl7XHJcbiAgXHJcblx0Y29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcclxuXHRuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICBcclxuXHRjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xyXG5cdGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIFxyXG5cdGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XHJcblx0aW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuXHRsZXQgcGljVXJsU21hbGwgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkuY29uY2F0KCctc21hbGwuanBnJyk7XHJcblx0Ly9pbWFnZS5zcmMgPSBwaWNVcmxTbWFsbDtcclxuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgcGljVXJsU21hbGwpO1xyXG5cdGltYWdlLmFsdCA9ICdJbWFnZSBvZiBcIicgKyByZXN0YXVyYW50Lm5hbWUgKyAnXCIgcmVzdGF1cmFudC4nO1xyXG4gIFxyXG5cdGNvbnN0IHNyY1NtYWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdXJjZS1zbWFsbCcpO1xyXG5cdGxldCBwaWNVcmxNZWRpdW0gPSBwaWNVcmxTbWFsbC5yZXBsYWNlKCdzbWFsbCcsJ21lZGl1bScpO1xyXG5cdHNyY1NtYWxsLnNyY3NldCA9IHBpY1VybFNtYWxsICsgJyAxeCwgJyArIHBpY1VybE1lZGl1bSArICcgMngnO1xyXG4gIFxyXG5cdGNvbnN0IHNyY0xhcmdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdXJjZS1sYXJnZScpO1xyXG5cdGxldCBwaWNVcmxMYXJnZSA9IHBpY1VybFNtYWxsLnJlcGxhY2UoJ3NtYWxsJywnbGFyZ2UnKTtcclxuXHRzcmNMYXJnZS5zcmNzZXQgPSBwaWNVcmxNZWRpdW0gKyAnIDF4LCAnICsgcGljVXJsTGFyZ2UgKyAnIDJ4JztcclxuXHJcblx0Ly9jb25zdCBwaWN0dXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtcGljdHVyZScpO1xyXG5cclxuXHRjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xyXG5cdGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XHJcblxyXG5cdC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXHJcblx0aWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XHJcblx0XHRmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xyXG5cdH1cclxuXHQvLyBmaWxsIHJldmlld3NcclxuXHRmaWxsUmV2aWV3c0hUTUwoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKXtcclxuXHRjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XHJcblx0Zm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XHJcblx0XHRjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xyXG5cclxuXHRcdGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcblx0XHRkYXkuaW5uZXJIVE1MID0ga2V5O1xyXG5cdFx0ZGF5LmNsYXNzTmFtZSA9ICd0YWJsZS1kYXknO1xyXG5cdFx0cm93LmFwcGVuZENoaWxkKGRheSk7XHJcblxyXG5cdFx0Y29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcblx0XHR0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XHJcblx0XHR0aW1lLmNsYXNzTmFtZSA9ICd0YWJsZS10aW1lJztcclxuXHRcdHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcclxuXHJcblx0XHRob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIHN1Ym1pdFJldmlldyAtIHN1Ym1pdHMgYSByZXZpZXcgdG8gdGhlIGRhdGFiYXNlXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBzdWJtaXRSZXZpZXcoZSkge1xyXG5cdGlmICghZSlcclxuXHRcdGUgPSB3aW5kb3cuZXZlbnQ7XHJcblx0Y29uc3Qgc2VuZGVyID0gZS5zcmNFbGVtZW50IHx8IGUudGFyZ2V0O1xyXG5cdGNvbnN0IGlkID0gc2VuZGVyLmdldEF0dHJpYnV0ZSgncmVzdGF1cmFudC1pZCcpO1xyXG5cdGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3LW5hbWUnKS52YWx1ZTtcclxuXHRjb25zdCBjb21tZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy10ZXh0JykudmFsdWU7XHJcblx0Y29uc3QgcmF0aW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy1yYXRpbmcnKS52YWx1ZTtcclxuXHRpZihuYW1lICYmIGNvbW1lbnQpe1xyXG5cdFx0Y29uc3QgZGF0YSA9IHtcclxuXHRcdFx0J3Jlc3RhdXJhbnRfaWQnOiBpZCxcclxuXHRcdFx0J25hbWUnOiBuYW1lLFxyXG5cdFx0XHQncmF0aW5nJzogcmF0aW5nLFxyXG5cdFx0XHQnY29tbWVudHMnOiBjb21tZW50LFxyXG5cdFx0XHQnY3JlYXRlZEF0JzogKG5ldyBEYXRlKCkpLmdldFRpbWUoKVxyXG5cdFx0fTtcclxuXHRcdGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG5cdFx0dWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChkYXRhKSk7XHJcblx0XHRjb25zdCByZXZpZXcgPSBEQkhlbHBlci5hZGRSZXN0YXVyYW50UmV2aWV3KGRhdGEpO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxSZXZpZXdzSFRNTChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MsIGlkID0gc2VsZi5yZXN0YXVyYW50LmlkKSB7XHJcblx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XHJcblx0aWYgKCFyZXZpZXdzKSB7XHJcblx0XHRjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcblx0XHRub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XHJcblx0XHRjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcclxuXHRcdHJldHVybjtcclxuXHR9XHJcblx0Y29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1jb21tZW50Jyk7XHJcblx0YnV0dG9uLnNldEF0dHJpYnV0ZSgncmVzdGF1cmFudC1pZCcsIGlkKTtcclxuXHRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdWJtaXRSZXZpZXcsIGZhbHNlKTtcclxuXHRjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuXHRyZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuXHRcdHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcblx0fSk7XHJcblx0Y29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpe1xyXG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHRjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG5cdG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XHJcblx0bGkuYXBwZW5kQ2hpbGQobmFtZSk7XHJcblxyXG5cdGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcblx0Ly9jb25zdCBjcmVhdGVkRGF0ZSA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpO1xyXG5cdGRhdGUuaW5uZXJIVE1MID0gbmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XHJcblx0bGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XHJcblxyXG5cdGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuXHRyYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XHJcblx0bGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcblx0Y29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcblx0Y29tbWVudHMuY2xhc3NOYW1lID0gJ3Jldmlldy1jb21tZW50cyc7XHJcblx0Y29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG5cdGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuXHJcblx0cmV0dXJuIGxpO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbmZ1bmN0aW9uIGZpbGxCcmVhZGNydW1iKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSB7XHJcblx0Y29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XHJcblx0Y29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cdGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuXHRicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSwgdXJsKXtcclxuXHRpZiAoIXVybClcclxuXHRcdHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG5cdG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tbXFxdXS9nLCAnXFxcXCQmJyk7XHJcblx0Y29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXHJcblx0XHRyZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xyXG5cdGlmICghcmVzdWx0cylcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdGlmICghcmVzdWx0c1syXSlcclxuXHRcdHJldHVybiAnJztcclxuXHRyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xyXG59XHJcblxyXG4vKmVzbGludCBuby1jb25zb2xlOiAwKi9cclxuLyplc2xpbnQgbm8tdW5kZWY6IDAqL1xyXG5pZiAoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xyXG5cdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xyXG5cdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0eWxlcycpLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcclxuXHRcdGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJ3Jlc3RhdXJhbnQuaHRtbCcpID09IC0xICl7XHJcblx0XHRcdG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCdzdy5qcycpLnRoZW4oKCkgPT4ge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKCdTZXJ2aWNlIFdvcmtlciBSZWdpc3RlcmQnKTtcclxuXHRcdFx0fSkuY2F0Y2goKGUpID0+IHtcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKGUpO1xyXG5cdFx0XHR9KTtcclxuXHRcdFx0aWYgKG5hdmlnYXRvci5vbkxpbmUgPT09IGZhbHNlKSB7XHJcblx0XHRcdFx0aW5pdE1hcCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9ZWxzZXtcclxuXHRcdFx0aWYgKG5hdmlnYXRvci5vbkxpbmUgPT09IGZhbHNlKSB7XHJcblx0XHRcdFx0aW5pdE1hcERldGFpbHMoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0pO1xyXG5cdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBEQkhlbHBlci5zZW5kUXVldWVkUmVxdWVzdHMsIGZhbHNlKTtcclxufSJdLCJmaWxlIjoiYWxsLmpzIn0=
